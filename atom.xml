<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>clock</title>
  
  
  <link href="https://ljweb.xyz/atom.xml" rel="self"/>
  
  <link href="https://ljweb.xyz/"/>
  <updated>2022-02-16T14:10:43.384Z</updated>
  <id>https://ljweb.xyz/</id>
  
  <author>
    <name>John Doe</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>51单片机的延时函数</title>
    <link href="https://ljweb.xyz/2022/01/10/51%E5%8D%95%E7%89%87%E6%9C%BA%E7%9A%84%E5%BB%B6%E6%97%B6%E5%87%BD%E6%95%B0/"/>
    <id>https://ljweb.xyz/2022/01/10/51%E5%8D%95%E7%89%87%E6%9C%BA%E7%9A%84%E5%BB%B6%E6%97%B6%E5%87%BD%E6%95%B0/</id>
    <published>2022-01-10T04:20:30.000Z</published>
    <updated>2022-02-16T14:10:43.384Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>参考：<a href="https://blog.csdn.net/weixin_43858743/article/details/86178280"> 51单片机的延时计算_海草海草的博客-CSDN博客_单片机delay延时时间怎么算</a></p></blockquote><h1 id="方法："><a href="#方法：" class="headerlink" title="方法："></a>方法：</h1><p>1.使用STC-ISP软件中的软件延时计算器(只能生成固定时间的函数)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;参考：&lt;a href=&quot;https://blog.csdn.net/weixin_43858743/article/details/86178280&quot;&gt; 51单片机的延时计算_海草海草的博客-CSDN博客_单片机delay延时时间怎么算&lt;/a&gt;&lt;/</summary>
      
    
    
    
    <category term="学习笔记" scheme="https://ljweb.xyz/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="51单片机" scheme="https://ljweb.xyz/tags/51%E5%8D%95%E7%89%87%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>2021电赛总结</title>
    <link href="https://ljweb.xyz/2021/12/13/2021%E7%94%B5%E8%B5%9B%E6%80%BB%E7%BB%93/"/>
    <id>https://ljweb.xyz/2021/12/13/2021%E7%94%B5%E8%B5%9B%E6%80%BB%E7%BB%93/</id>
    <published>2021-12-13T15:10:08.000Z</published>
    <updated>2022-02-16T14:10:43.372Z</updated>
    
    <content type="html"><![CDATA[<h2 id="挫折之后的成长"><a href="#挫折之后的成长" class="headerlink" title="挫折之后的成长"></a>挫折之后的成长</h2><p>&emsp;&emsp;2021年的电赛过去近两个月了，这是我第一次参加电赛，虽然最后没能完赛（我太菜啦！）但是经过这次的电赛的经历也让我认识到了和大佬的差距和自身的不足。也让我彻底爱上了这种学习、设计，制作、头脑风暴的感觉。希望自己能记住这次的失利，记住这落差。不会被一时的挫折而抹杀专注和热爱，以后好好玩且玩好！</p><h2 id="赛题分析"><a href="#赛题分析" class="headerlink" title="赛题分析"></a>赛题分析</h2><p>&emsp;&emsp;我们组选择的是F题：<a href="https://ljweb.xyz/files/%E6%99%BA%E8%83%BD%E9%80%81%E8%8D%AF%E5%B0%8F%E8%BD%A6%EF%BC%88F%E9%A2%98%EF%BC%89.pdf">做一个送药小车</a>，基础题一共有三个任务（因为是第一次参加电赛我们就奔着基础题去了），小车先要在起点识别出给定的数字（数字打印在纸上），取到药品后循迹去数字对应的药房，然后等待药品卸货，最后自主返回起点。</p><p><img src="/2021/12/13/2021%E7%94%B5%E8%B5%9B%E6%80%BB%E7%BB%93/1.3.png" alt="tm"></p><p>&emsp;&emsp;4号早上题目出来后，我和队员们一时都傻了眼！因为我们都是大二的同学，如果此次电赛不推迟到11月的话，我们队伍甚至才大一，我们谁都没有做这么难项目的经验。实不相瞒，以我们团队目前的水平只能写个51单片机，当时五月份报名参加电赛的时候也是抱着见世面去试一试的，而参加这次比赛的学长们，也都放弃了以往相对简单的但今年难度上天的小车题（当然其他组的题目也不好做），所以我们面对的情况就是，全校就两组在做小车题（另一组也是和我们一样，大二，没有相关经验）。</p><h2 id="电赛F题的难点："><a href="#电赛F题的难点：" class="headerlink" title="电赛F题的难点："></a>电赛F题的难点：</h2><h5 id="1-循迹："><a href="#1-循迹：" class="headerlink" title="1.循迹："></a>1.循迹：</h5><p><img src="/2021/12/13/2021%E7%94%B5%E8%B5%9B%E6%80%BB%E7%BB%93/1.png" alt="医院地图"></p><p>&emsp;&emsp;我做过一个用红外来循迹的51小车，但是题目为了增大难度，如图，轨道中间的线是红色的（因为红色和赛道背景的白色反差不像黑色和白色那样大😭），所以用不了红外的方案。这下我们想到的就是使用OpenMv进行视觉循迹（其实也可以用灰度传感器！），可是我们从来没接触过OpenMv，只能现学现做，还好我从一个做无人机组的学长那里借来了一个OpenMv，这让我能题目确定之后立马开始学习OpenMv。然后老师也帮我们买了新的OpenMv模块，解决了燃眉之急。</p><p>&emsp;&emsp;在我开始学习OpenMv的时候，另外一名队友在做小车的硬件部分，因为实验室有很多四驱小车的车模，所以我们最后就采用了。</p><p><img src="/2021/12/13/2021%E7%94%B5%E8%B5%9B%E6%80%BB%E7%BB%93/2.1.png" alt="第一版车模"></p><p>&emsp;&emsp;我们用的是Arduino uno当下位机，原因是arduino比较简单，程序很好写，我当时的想法是信息处理和电机动作控制都在OpenMv上做，arduino只用来进行简单的收到串口通讯指令后控制电机和两个LED灯。</p><p>&emsp;&emsp;红线循迹的部分我第二天实现了，也能识别出十字路口，然后停下。</p><h5 id="2-数字识别："><a href="#2-数字识别：" class="headerlink" title="2.数字识别："></a>2.数字识别：</h5><p><img src="/2021/12/13/2021%E7%94%B5%E8%B5%9B%E6%80%BB%E7%BB%93/1.1.png" alt="字模"></p><p>&emsp;&emsp;数字识别我也用的是OpenMv的模板匹配，识别效果还行，就是对小车的角度和距离都比较高，但是没办法，比赛已经到第二天了，再买元件已经来不及了，只能硬着头皮做下去。</p><p>&emsp;&emsp;数字识别在第三天的最后也做得差不多了，到这里，小车已经能从起点出发，循迹找到十字路口后，停下来进行识别了，或者进行转弯。两天内从0开始学习到能识别到数字还是很激动的，这得益于OpenMv好上手的特性，这也是我当初选择OpenMv的原因。可也带来很大弊端，因为我从来没有学过python，后面逻辑部分没有了历程的支持我就遇到大问题了。</p><p><img src="/2021/12/13/2021%E7%94%B5%E8%B5%9B%E6%80%BB%E7%BB%93/4.png" alt="最后还在写代码的老胡"></p><p>最后还在写代码的老胡（请忽略我们很乱的实验室 😂 ）</p><h5 id="3-逻辑"><a href="#3-逻辑" class="headerlink" title="3.逻辑"></a>3.逻辑</h5><p>&emsp;&emsp;赛题要求一套代码解决所有问题，对没什么经验的我来说，这难度比上天还难，因为我们只有OpenMv，所以只能在上面又跑循迹又跑数字识别，逻辑就很难写，虽然我们队伍里面有一位计算机的同学，他学过python，但由于我们都是第一次接触OpenMv，在最后我熬了一晚上，白天又战斗了最后十几小时之后，我们还是失败了。</p><p><img src="/2021/12/13/2021%E7%94%B5%E8%B5%9B%E6%80%BB%E7%BB%93/3.png" alt="最后"></p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>&emsp;&emsp;其实不难发现，我们这次的失败是必然的。因为团队里面没有一个人有学过这些知识，知识储备不足是一方面。还有队员的任务分配也出现了一些问题，电赛是三人一组，我们当时的分配是一个人负责打杂和写设计报告，另外两个一个负责整个项目的制作部分。因为选择的题目对我们来说太难，除了我学习了点OpenMv之外，另外两名队员没能参与进来，导致分工不合理。</p><p>&emsp;&emsp;但我还是觉得能参加这样的比赛，很值得，比赛的过程很过瘾，特别是解决一个又一个问题的过程。这让我更加有动力去学习，补缺补差。明年的比赛我们还会参加的！</p><h2 id="感谢"><a href="#感谢" class="headerlink" title="感谢"></a>感谢</h2><p>&emsp;&emsp;❤️真的很感谢比赛中学校和老师们的帮助，也很感谢好队友给我带饭，能让我选择困难的题目挑战自己。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;挫折之后的成长&quot;&gt;&lt;a href=&quot;#挫折之后的成长&quot; class=&quot;headerlink&quot; title=&quot;挫折之后的成长&quot;&gt;&lt;/a&gt;挫折之后的成长&lt;/h2&gt;&lt;p&gt;&amp;emsp;&amp;emsp;2021年的电赛过去近两个月了，这是我第一次参加电赛，虽然最后没能完赛（我太</summary>
      
    
    
    
    <category term="学习笔记" scheme="https://ljweb.xyz/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="OpenMv" scheme="https://ljweb.xyz/tags/OpenMv/"/>
    
  </entry>
  
  <entry>
    <title>使用51单片机驱动蜂鸣器播放音乐</title>
    <link href="https://ljweb.xyz/2021/11/29/%E4%BD%BF%E7%94%A851%E5%8D%95%E7%89%87%E6%9C%BA%E9%A9%B1%E5%8A%A8%E8%9C%82%E9%B8%A3%E5%99%A8%E6%92%AD%E6%94%BE%E9%9F%B3%E4%B9%90/"/>
    <id>https://ljweb.xyz/2021/11/29/%E4%BD%BF%E7%94%A851%E5%8D%95%E7%89%87%E6%9C%BA%E9%A9%B1%E5%8A%A8%E8%9C%82%E9%B8%A3%E5%99%A8%E6%92%AD%E6%94%BE%E9%9F%B3%E4%B9%90/</id>
    <published>2021-11-29T15:49:50.000Z</published>
    <updated>2022-02-16T14:10:43.384Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>参考：<a href="https://blog.csdn.net/m0_37697335/article/details/84915995">https://blog.csdn.net/m0_37697335/article/details/84915995</a></p></blockquote><h3 id="有源蜂鸣器与无源蜂鸣器的区别"><a href="#有源蜂鸣器与无源蜂鸣器的区别" class="headerlink" title="有源蜂鸣器与无源蜂鸣器的区别"></a>有源蜂鸣器与无源蜂鸣器的区别</h3><h4 id="无源蜂鸣器的特点是："><a href="#无源蜂鸣器的特点是：" class="headerlink" title="无源蜂鸣器的特点是："></a>无源蜂鸣器的特点是：</h4><p>1、 无源内部不带震荡源，所以如果用直流信号无法令其鸣叫。必须用2K~5K的方波（建议使用PWM）去驱动它</p><p>2、 声音频率可控，可以做出“多来米发索拉西”的效果。                                                                                                                    </p><p>3、 可以使呈现的发音效果更丰富，当然控制方式也因此变得比有源蜂鸣器更复杂一点。</p><h4 id="有源蜂鸣器的特点是："><a href="#有源蜂鸣器的特点是：" class="headerlink" title="有源蜂鸣器的特点是："></a>有源蜂鸣器的特点是：</h4><p>1 、有源蜂鸣器内部带震荡源，所以只要一通电就会叫<br>2、 程序控制方便，单片机一个高低电平就可以让其发出声音，而无源蜂鸣器却做不到。                                                                  </p><p>3、 效果单一，但是控制简单，如果仅是作为单一无变化的提示音使用，有源蜂鸣器无疑是一种好选择。</p><h3 id="参考代码"><a href="#参考代码" class="headerlink" title="参考代码"></a>参考代码</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;reg52.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> RldTmr(fr) 65536 - (11059200 / 12) / (fr &lt;&lt; 1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FuDian(n) (n &lt;&lt; 1) / 3    <span class="comment">//附点n分音符的换算</span></span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> UCHAR;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> UINT;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> ULONG;</span><br><span class="line"> </span><br><span class="line">sbit BUZZ = P0^<span class="number">0</span>;</span><br><span class="line"> </span><br><span class="line">UINT code noteFreq[] = &#123;    <span class="comment">//中音 1-7 和高音 1-7对应的频率列表</span></span><br><span class="line">    <span class="number">523</span>, <span class="number">587</span>, <span class="number">659</span>, <span class="number">698</span>, <span class="number">784</span>, <span class="number">880</span>, <span class="number">988</span>,</span><br><span class="line">    <span class="number">1047</span>, <span class="number">1175</span>, <span class="number">1319</span>, <span class="number">1397</span>, <span class="number">1568</span>, <span class="number">1760</span>, <span class="number">1976</span></span><br><span class="line">&#125;;</span><br><span class="line">UINT code tmrRld[] = &#123;      <span class="comment">//中音 1-7 和高音 1-7对应的定时器重载值</span></span><br><span class="line">    RldTmr(<span class="number">523</span>), RldTmr(<span class="number">587</span>), RldTmr(<span class="number">659</span>), RldTmr(<span class="number">698</span>), RldTmr(<span class="number">784</span>), RldTmr(<span class="number">880</span>), RldTmr(<span class="number">988</span>),</span><br><span class="line">    RldTmr(<span class="number">1047</span>), RldTmr(<span class="number">1175</span>), RldTmr(<span class="number">1319</span>), RldTmr(<span class="number">1397</span>), RldTmr(<span class="number">1568</span>), RldTmr(<span class="number">1760</span>), RldTmr(<span class="number">1976</span>),</span><br><span class="line">&#125;;</span><br><span class="line">UCHAR code musicNote[] = &#123;      <span class="comment">//音名</span></span><br><span class="line">    <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>,</span><br><span class="line">    <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>,</span><br><span class="line">    <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>,</span><br><span class="line">    <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>,</span><br><span class="line">    <span class="number">5</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">1</span>,</span><br><span class="line">    <span class="number">5</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">1</span>,</span><br><span class="line">    <span class="number">1</span>, <span class="number">5</span>, <span class="number">1</span>,</span><br><span class="line">    <span class="number">1</span>, <span class="number">5</span>, <span class="number">1</span></span><br><span class="line">&#125;;</span><br><span class="line">UCHAR code noteDuration[] = &#123;       <span class="comment">//音名对应的时值，4表示4分音符，8表示8分音符，16表示16分音符</span></span><br><span class="line">    <span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>,</span><br><span class="line">    <span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>,</span><br><span class="line">    <span class="number">4</span>, <span class="number">4</span>, <span class="number">2</span>,</span><br><span class="line">    <span class="number">4</span>, <span class="number">4</span>, <span class="number">2</span>,</span><br><span class="line">    FuDian(<span class="number">8</span>), <span class="number">16</span>, FuDian(<span class="number">8</span>), <span class="number">16</span>, <span class="number">4</span>, <span class="number">4</span>,</span><br><span class="line">    FuDian(<span class="number">8</span>), <span class="number">16</span>, FuDian(<span class="number">8</span>), <span class="number">16</span>, <span class="number">4</span>, <span class="number">4</span>,</span><br><span class="line">    <span class="number">4</span>, <span class="number">4</span>, <span class="number">2</span>,</span><br><span class="line">    <span class="number">4</span>, <span class="number">4</span>, <span class="number">2</span></span><br><span class="line">&#125;;</span><br><span class="line">bit enable = <span class="number">1</span>, tmrFlg = <span class="number">0</span>;</span><br><span class="line">UCHAR T0RH = <span class="number">0XFF</span>, T0RL = <span class="number">0X00</span>;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Delay</span><span class="params">(UINT n)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">PlayMusic</span><span class="params">(UCHAR speed)</span></span>;    <span class="comment">//固定标准为4分音符的速度：例如speed = 108 表示一分钟扫过108个4分音符</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    EA = <span class="number">1</span>;</span><br><span class="line">    TMOD = <span class="number">0X01</span>;</span><br><span class="line">    TH0 = T0RH;</span><br><span class="line">    TL0 = T0RL;</span><br><span class="line">    ET0 = <span class="number">1</span>;</span><br><span class="line">    TR0 = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        PlayMusic(<span class="number">72</span>);</span><br><span class="line">        Delay(<span class="number">40000u</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Delay</span><span class="params">(UINT n)</span> </span>&#123;</span><br><span class="line">    UINT i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; i++) ;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">PlayMusic</span><span class="params">(UCHAR speed)</span> </span>&#123;</span><br><span class="line">    UCHAR i;</span><br><span class="line">    UCHAR idx;</span><br><span class="line">    UINT cnt = <span class="number">0</span>;</span><br><span class="line">    UINT durationCnt = <span class="number">0</span>;<span class="comment">//当前音符的时值对应的定时器计数</span></span><br><span class="line">    UINT soundCnt = <span class="number">0</span>;<span class="comment">//当前音符的发声时值对应的计数值</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="keyword">sizeof</span> (musicNote); ) &#123;</span><br><span class="line">        <span class="keyword">while</span> (!tmrFlg) ;</span><br><span class="line">        tmrFlg = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (cnt == <span class="number">0</span>) &#123;</span><br><span class="line">            idx = musicNote[i] - <span class="number">1</span>;</span><br><span class="line">            T0RH = tmrRld[idx] &gt;&gt; <span class="number">8</span>;</span><br><span class="line">            T0RL = tmrRld[idx];</span><br><span class="line">            durationCnt = (ULONG)<span class="number">240</span> * (ULONG)noteFreq[idx] / ((ULONG)noteDuration[i] * (ULONG)speed);</span><br><span class="line">            soundCnt = durationCnt - (durationCnt &gt;&gt; <span class="number">2</span>);<span class="comment">//当前音符时值的前3/4发声，后1/4静音</span></span><br><span class="line">            enable = <span class="number">1</span>;</span><br><span class="line">            cnt++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (cnt == durationCnt) &#123;</span><br><span class="line">                cnt = <span class="number">0</span>;</span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                cnt++;</span><br><span class="line">                <span class="keyword">if</span> (cnt == soundCnt) &#123;</span><br><span class="line">                    enable = <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">InterruptTmr0</span><span class="params">()</span> interrupt 1 </span>&#123;</span><br><span class="line">    TH0 = T0RH;</span><br><span class="line">    TL0 = T0RL;</span><br><span class="line">    tmrFlg = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (enable)</span><br><span class="line">        BUZZ = ~BUZZ;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        BUZZ = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;参考：&lt;a href=&quot;https://blog.csdn.net/m0_37697335/article/details/84915995&quot;&gt;https://blog.csdn.net/m0_37697335/article/details/84</summary>
      
    
    
    
    <category term="51单片机" scheme="https://ljweb.xyz/categories/51%E5%8D%95%E7%89%87%E6%9C%BA/"/>
    
    
    <category term="51" scheme="https://ljweb.xyz/tags/51/"/>
    
  </entry>
  
  <entry>
    <title>有限差分法处理电磁场问题</title>
    <link href="https://ljweb.xyz/2021/11/28/%E6%9C%89%E9%99%90%E5%B7%AE%E5%88%86%E6%B3%95%E5%A4%84%E7%90%86%E7%94%B5%E7%A3%81%E5%9C%BA%E9%97%AE%E9%A2%98/"/>
    <id>https://ljweb.xyz/2021/11/28/%E6%9C%89%E9%99%90%E5%B7%AE%E5%88%86%E6%B3%95%E5%A4%84%E7%90%86%E7%94%B5%E7%A3%81%E5%9C%BA%E9%97%AE%E9%A2%98/</id>
    <published>2021-11-28T16:00:00.000Z</published>
    <updated>2022-02-16T14:10:43.468Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/2021/11/28/%E6%9C%89%E9%99%90%E5%B7%AE%E5%88%86%E6%B3%95%E5%A4%84%E7%90%86%E7%94%B5%E7%A3%81%E5%9C%BA%E9%97%AE%E9%A2%98/1.1.jpg" alt="img1.1">  <img src="/2021/11/28/%E6%9C%89%E9%99%90%E5%B7%AE%E5%88%86%E6%B3%95%E5%A4%84%E7%90%86%E7%94%B5%E7%A3%81%E5%9C%BA%E9%97%AE%E9%A2%98/2.1.jpg" alt="img2.1"></p><h3 id="mag-参考代码："><a href="#mag-参考代码：" class="headerlink" title=":mag: 参考代码："></a>:mag: 参考代码：</h3><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">clear all</span><br><span class="line">m=<span class="number">22</span>;</span><br><span class="line"><span class="keyword">for</span> k=<span class="number">1</span>:m</span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">j</span>=<span class="number">1</span>:m</span><br><span class="line">        <span class="keyword">if</span> k==<span class="number">1</span></span><br><span class="line">            V(<span class="built_in">j</span>,k)=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">elseif</span> ((<span class="built_in">j</span>==<span class="number">1</span>)|(<span class="built_in">j</span>==m)|(k==m))</span><br><span class="line">            V(<span class="built_in">j</span>,k)=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            V(<span class="built_in">j</span>,k)=<span class="number">0.5</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">cha=<span class="number">0.01</span>;</span><br><span class="line">delta=<span class="number">0</span>;</span><br><span class="line">n=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">    n=n+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> k=<span class="number">2</span>:m<span class="number">-1</span></span><br><span class="line">        <span class="keyword">for</span> <span class="built_in">j</span>=<span class="number">2</span>:m<span class="number">-1</span></span><br><span class="line">            Vnew(<span class="built_in">j</span>,k)=<span class="number">0.25</span>*(V(<span class="built_in">j</span>+<span class="number">1</span>,k)+V(<span class="built_in">j</span><span class="number">-1</span>,k)+V(<span class="built_in">j</span>,k+<span class="number">1</span>)+V(<span class="built_in">j</span>,k<span class="number">-1</span>));</span><br><span class="line">            d=<span class="built_in">abs</span>((Vnew(<span class="built_in">j</span>,k)-V(<span class="built_in">j</span>,k))/V(<span class="built_in">j</span>,k));</span><br><span class="line">            <span class="keyword">if</span> d&gt;delta</span><br><span class="line">                delta=d;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            V(<span class="built_in">j</span>,k)=Vnew(<span class="built_in">j</span>,k);</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">if</span> delta&lt;cha</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">if</span> n&gt;<span class="number">100</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    delta=<span class="number">0.</span>;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">k=<span class="number">1</span>:m;</span><br><span class="line"><span class="built_in">j</span>=<span class="number">1</span>:m;</span><br><span class="line"><span class="built_in">figure</span>(<span class="number">1</span>)</span><br><span class="line">[DX,DY]=gradient(V,<span class="number">.4</span>,<span class="number">.4</span>);</span><br><span class="line"><span class="built_in">hold</span> on</span><br><span class="line">quiver(k,<span class="built_in">j</span>,DX,DY,<span class="number">2</span>)</span><br><span class="line"><span class="built_in">hold</span> off</span><br><span class="line">xlabel(<span class="string">&#x27;电场线图像&#x27;</span>)</span><br><span class="line">title(<span class="string">&#x27;姓名&#x27;</span>)</span><br><span class="line"><span class="built_in">figure</span>(<span class="number">2</span>)</span><br><span class="line">[DX,DY]=gradient(V,<span class="number">.4</span>,<span class="number">.4</span>)</span><br><span class="line">A=(DX.^<span class="number">2</span>+DY.^<span class="number">2</span>).^<span class="number">0.5</span>;</span><br><span class="line">[DA,DB]=gradient(A,<span class="number">.4</span>,<span class="number">.4</span>);</span><br><span class="line"><span class="built_in">hold</span> on</span><br><span class="line">quiver(k,<span class="built_in">j</span>,DA,DB,<span class="number">2</span>)</span><br><span class="line"><span class="built_in">hold</span> off</span><br><span class="line">xlabel(<span class="string">&#x27;电力线图像&#x27;</span>)</span><br><span class="line">title(<span class="string">&#x27;姓名&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;img src=&quot;/2021/11/28/%E6%9C%89%E9%99%90%E5%B7%AE%E5%88%86%E6%B3%95%E5%A4%84%E7%90%86%E7%94%B5%E7%A3%81%E5%9C%BA%E9%97%AE%E9%A2%98/1.1.jp</summary>
      
    
    
    
    
    <category term="实验" scheme="https://ljweb.xyz/tags/%E5%AE%9E%E9%AA%8C/"/>
    
  </entry>
  
  <entry>
    <title>mini Macintosh plus(基于ESP32)</title>
    <link href="https://ljweb.xyz/2021/11/25/mini-macintosh-plus-%E5%9F%BA%E4%BA%8EESP32/"/>
    <id>https://ljweb.xyz/2021/11/25/mini-macintosh-plus-%E5%9F%BA%E4%BA%8EESP32/</id>
    <published>2021-11-25T12:54:21.000Z</published>
    <updated>2022-02-16T14:10:43.384Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>参考：<a href="https://spritesmods.com/?art=minimacplus">Sprites mods - Miniature Macintosh Plus - Intro</a></p></blockquote><h1 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h1><img src="https://spritesmods.com/minimacplus/mac_teaser.png" alt="img"><p>Back in the early days of computing, there was a company called Apple. They just had great success with their Apple II line of computers, but needed to innovate to stay on top of the quickly-developing computer scene. They already were working on the Lisa line of computers, a minicomputer-inspired beast intended for business users and priced as such, but that was deemed too expensive for the average customer. As a secondary project, the Macintosh was developed, initially with the idea in mind to make a new generation of computer for ‘the man on the street’ which should cost about $500. Steve Jobs got put on the project, and under him the hardware got more advanced,the software got a GUI instead of a text interface, and the price ballooned into almost $2500. Although the hardware you got for this price was slightly underwhelming, lacking e.g. the graphics accelerators and hardware sound capabilities other machines had, the software made more than up for it. This first Macintosh was the Mac 128K and its succes spurned more advanced models of this compact Mac, namely the Macintosh 512K, the Macintosh Plus, and the Macintosh SE-series. </p><p>While the development of the Macintosh happened around 1984, way before I was at an age I could understand computers, I do feel some kind of kinship with the compact Macintosh: the first computer my parents owned was a Macintosh Plus. It was later joined by a 20MB SCSI hard disk, and on that machine I wrote my first Basic-programs. Back when I still lived in the Netherlands, I actually bought a broken SE/30 machine and <a href="http://spritesmods.com/?art=macsearm">converted</a> that into a Linux-server while still being able to run Mac-software. I left that machine in the Netherlands, however, and here in Shanghai, I have no classic Apple hardware anymore.</p><p>While obviously I don’t really need a Mac Plus anymore for my day-to-day life, I did like the idea of having one available for when I felt nostalgic. Maybe I could get a tiny bit of the Macintosh experience back by building a small one myself. Seeing I already have some experience with <a href="https://hackaday.com/2016/11/28/tiniest-game-boy-hides-in-your-pocket/">making smaller versions of old hardware</a>, why not try to apply that process to the venerable Mac Plus as well?</p><h1 id="Display"><a href="#Display" class="headerlink" title="Display"></a>Display</h1><p>So, what to use when building something like this? One of the ways that sprung to mind was to take a Raspberry Pi or something, add a 2.5” LCD, add an emulator like PCE or MiniVMac, 3d-print an enclosure and call it a day. But I didn’t feel that would do my idea justice: not only would it be too big for my tastes, it also would be too easy: With the original Mac 128K, even while the end result was seen as underpowered, the hardware designers that built it did their best to pull a few nice tricks to save cost. Just assembling off-the-shelf commodity hardware into a replica felt like I would be doing the original design a disservice. So off to Taobao for some more exotic components I went!</p><p><img src="https://spritesmods.com/minimacplus/oled_taobao.png" alt="img"></p><p>I decided to start with the display. The Mac had a fairly high-resolution display for its time, and finding a display to replicate that had a pretty high priority. In general, when it comes to displays available on the Chinese electronic market, there’s a large choice available. Unfortunately, the ‘large choice’ seems to consist of either higher-resolution but larger screens, or alternatively tiny but lower-resolution screens. Ideally, I needed a resolution of 512x342 pixels; that is the native Mac resolution and on a screen like that, I would be able to display everything without rescaling. Unfortunately, screens with this resolution don’t readily exist; the next best resolution up would be something like 640x480. Screens with that resolution, for some reason, tend to start out pretty big: the smallest viable one I could find was about 3.5”. So unfortunately, I would have to do some downscaling if I wanted to make the Mac as small as possible.</p><p>After deciding it would be okay to downscale a bit, I had access to a fair amount more displays. One of the displays that popped up pretty quickly was the x163qln01, an 1.63” OLED screen made by AUO. While slightly expensive (about US$25 per screen), this display has good availability on Taobao and a datasheet that at least documents the pinouts, dimensions and power source requirements. This display seems to be made for certain Android smartwatches, and with some mangling of search terms, Google even spat out some initialization sequences I could use.</p><p>The only problem (well, aside from the connector that had pins a mere 0.5mm apart) was that the display did not use a parallel or SPI interface, but a MIPI interface. I’d have to tackle that later on.</p><p>With the choice of display made, I could move on to the processor. I grabbed an ESP32-Wrover module for this. This module contains an ESP32 (a WiFi chip with 2 32-bit CPUs running at 240MHz and about half a megabyte of RAM), 4MiB of flash and 4MiB of PSRAM memory. My guess was that the 2 CPU cores would be fast enough to emulate a Mac and that I could use the 4MiB of PSRAM memory to give the Mac its RAM. While 4MiB of flash is not that much, it should be enough for the emulator plus a small-ish hard disk with the system software and some programs. Also, it helps that I work for Espressif, making me pretty familiar with the hardware; what also helped was that I could just grab some modules from work instead of having to buy them and then wait for them to arrive.</p><p>With that, I was mostly set - the OLED still needed some components to be powered so the component count was increased by some LDO and other power supply chips. The Mac also needed sound so I sourced a cheap amplifier chip and speaker, and for power and debugging I pulled a common FT232 module out of a drawer somewhere. All these components are pretty small and allow me to scale down the enclosure, resulting in a model that would be a little bit bigger than 1/6th of a real Mac.</p><h1 id="Driving-the-display"><a href="#Driving-the-display" class="headerlink" title="Driving the display"></a>Driving the display</h1><p>While I had nothing to complain about the resolution, size and brightness of the display, actually getting pixels to it was more problematic. The MIPI interface it has was not supported by the ESP32 silicon so I would have to find another way to interface with it. The MIPI DSI interface is a standard developed by the <a href="https://mipi.org/">MIPI Alliance</a> and not public; as a hobbyist, I’d have to piece together the details from leaked documents and probing of existing devices. Luckily, a year or two ago <a href="http://www.electricstuff.co.uk/">Mike Harrison</a> reverse engineered the MIPI DSI interface used to control iPod displays (<a href="https://www.youtube.com/watch?v=7TedIzmguP0">1</a>, <a href="https://www.youtube.com/watch?v=IIR1Bw8T_vM">2</a>, <a href="https://www.youtube.com/watch?v=YYadGWR3Xuo">3</a>, <a href="https://www.youtube.com/watch?v=dPzeEw3zVwQ">4</a>, <a href="https://www.youtube.com/watch?v=5gvO8-bGMpI">5</a>, <a href="http://www.electricstuff.co.uk/nanohack.html">website</a>) and also managed to find some copies of the specifications. This made my life a lot easier: it helps to at least know what to send to the display.</p><p>While there is a lot more to it (and you should really watch the above videos if you want to know what), the physical layer of the MIPI protocol is pretty simple to explain. The MIPI protocol uses four wires in total: two data- and two clock-lines. The MIPI protocol has two modes of signalling: Low Power (LP) mode and High Speed (HS) mode.</p><p>​                 <a href="https://spritesmods.com/minimacplus/mipi_signal.png"><img src="https://spritesmods.com/minimacplus/mipi_signal-tmb.png" alt="img"></a></p><p>In Low Power mode, the wires are used separately to transmit some control data structures as well as indicate certain commands that have direct effect on the physical receiver on the other side. The voltage swing in this mode is pretty large compared to the high speed mode: voltages are either around 1.2 volt for a high signal, or around 0 volt for a low signal. Because low speed mode has more signal states, it does things like tell the receiver to enter or exit high speed mode. In the diagram above, the blue lines indicate Low Power communication.</p><p>In High Speed mode, the two clock lines (CLKP/CLKN) as well as the two data lines (DP/DN) work as differential lines, with one line always being the opposite as the other one. The receiver detects the difference between the two lines, and deduces the value being sent from this: a 1 if DP is higher, a 0 if DN is higher. High-speed mode, as the name implies, allows for very quick data transfers with clocks up to 1.5GHz. The trick the standard used to get this done without too much EMC and power use is to use very low voltages in this mode: the voltages on the pairs average to about 200mV, with variations of +/- 100mV per line to indicate the ones and zeroes. In the above diagram, the red bits are done in high-speed mode.</p><p>For the actual data transfer, in high speed mode the interface can essentially be seen as a somewhat weird and differential SPI interface: there is a clock and data path, and every clock tick, the value of the data is clocked into the interface. A change from SPI, apart from the fact that the signals are differential, is that a data bit is clocked in whenever the CLK lines change state, instead of only on e.g raising edges. Another difference is that the start of a transfer is detected not by a /CS line going low, but by in-band signalling: every transmission starts with one unique binary ‘magic word’ and the receiver detects this value to decide when a transmission starts.</p><p>In order to interface this with the ESP32, I’d have to do some level shifting. I wanted to run the ESP32 from a 3.0V power source, so all GPIOs would also be 3.0 or 0 volt. To adapt this to the signal levels of the MIPI interface, I opted for the most cheap solution: just use some resistor divider networks.</p><p>To figure out the resistor values, I effectively made equations for the three voltage output states that interested me (1.1V for Low Power high, 0.07V for High Speed low, 0.33V for High Speed high; voltages chosen to stay in-spec for most situations) and the three input states that should generate them. Using some math, I ended up at some equations. I could theoreticaly work out those equations by hand, but eventually decided to throw them into <a href="https://www.wolframalpha.com/">WolframAlpha</a> which gave me the needed resistor values.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">           3V</span><br><span class="line">G -R1--+   R3</span><br><span class="line">G -R2--+ --+----&gt;</span><br><span class="line">           R4</span><br><span class="line">           GND</span><br><span class="line"></span><br><span class="line">R4*(1.9/R1+1.9/R3)=1.1, </span><br><span class="line">(1/(1/R4+1/R1+1/R2))*(2.93/R3)=0.07, </span><br><span class="line">(1/(1/R4+1/R1))*2.67*(1/R3+1/R2)=0.33, </span><br><span class="line">R2=1000</span><br><span class="line"></span><br><span class="line">R1=280, R2=1K, R3=3K6, R4=150</span><br></pre></td></tr></table></figure><p>At that time, I figured I could also cheat a bit: because the lines are differential in high-speed mode, the display will only look at the difference between the two lines to deduce the data sent. This means that I can save a GPIO by holding one of the lines at a fixed voltage, making the other line higher and lower as needed. To do this, I needed a second type of resistor network:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">           3V</span><br><span class="line">           R3</span><br><span class="line">G -R1--+ --+----&gt;</span><br><span class="line">           R4</span><br><span class="line">           GND</span><br><span class="line"></span><br><span class="line">R4*(1.9/R1+1.9/R3)=1.1,</span><br><span class="line">(1/(1/R4+1/R1))*(2.8/R3)=0.2,</span><br><span class="line">R4=150</span><br><span class="line"></span><br><span class="line">R1=320, R3=1500, R4=150</span><br></pre></td></tr></table></figure><p>Another thing to solve was the clocking scheme. Normal SPI clocks in a bit on a raising edge of the clock line. (Or a falling one, depending on the configuration.) MIPI clocks in a bit on both the raising as well as the falling edge of the clock signal. While the ESP32s hardware SPI unit cannot by itself generate a signal like this, we can convert from one to another by using a simple D-type flipflop with its inverted output connected to its input. Every clock pulse on the input will change the level of the output, exactly as is needed here.</p><h1 id="Schematic"><a href="#Schematic" class="headerlink" title="Schematic"></a>Schematic</h1><p>With the display hardware fixed up, the hardest part of the hardware design was done. Now we only need to add the rest. First up, the power supply. This is pretty simple: I feed the entire design from 5V from an USB-to-serial converter that I also can use as a debugging/programming interface. That voltage is taken to generate the +4.6V, -3.4V and 1.8V the OLED screen needs, as well as the 3.0V to feed the ESP32. The +4.6V and -3.4V are generated by a TPS65631 chip, and a reference schematic for that was included in the datasheet for thr OLED. The other voltages are generated by a pair of simple LDOs.<br><a href="https://spritesmods.com/minimacplus/schematic_oledpsu.png"><img src="https://spritesmods.com/minimacplus/schematic_oledpsu-tmb.png" alt="img"></a></p><p>The Macintosh also had sound. The quality isn’t that good by modern standards (22KHz, 8-bit) but the sounds that various software programs make are by now quite iconic, so I couldn’t forego a speaker here. The ESP32 has a built-in 8-bit DAC, and that is used to render the analog soundwaves that the emulator generates. That then gets put into a NS8002 which is a 2W class-AB audio amplifier housed in a small SOIC8 package. It is cheap, needs very few support components and makes more than enough noise for the tiny Mac to attract attention.<br><a href="https://spritesmods.com/minimacplus/schematic_audio.png"><img src="https://spritesmods.com/minimacplus/schematic_audio-tmb.png" alt="img"></a></p><p>One of the things that made the Macintosh so revolutionary is that it was one of the first commercial computers that came with a mouse. The Macintosh team thought so highly of the mouse that essentially the entire OS is based around mouse-controlled UI elements, and unlike, for example, an IBM PC, it is entirely possible to control the entire Macintosh with only a mouse. Obviously, my tiny Mac should also have such an important peripheral. I still do remember the original ball mouse that came with the early Macintoshes, and I do not quite relish the need to get the gunk off the little rollers every so often; there is a reason optical mice have replaced these mechanical devices entirely. This also has the advantage that parts for these new-fangles optical mice are quite easy to obtain: I did not need to spend much effort at all to locate a source of ADNS9500 gaming mouse sensors plus the corresponding optics, for instance.</p><p>The other nice thing is that an optical mouse sensor is a pretty deeply integrated device: a mouse sensor only needs a few other external components to function, and the schematic reflects this. There are a few capacitors for voltage stabilization, an MOSFET (copied straight from the datasheet) to switch the laser diode, and some other jellybean parts. The mouse sensor communicates using a four-wire SPI signal, and I’ve re-used one of these wires to also send the mouse button signal over: the MISO pin is pulled down with a fairly strong pulldown when this button is pressed. The value of this pulldown resistor is not enough to stop the mouse sensor from communicating, but it is enough to overcome the pullup-resistor that normally pulls up the line, so when the sensor tristates the MISO line, the ESP32 can detect if the button is pressed.<br><a href="https://spritesmods.com/minimacplus/schematic_mouse.png"><img src="https://spritesmods.com/minimacplus/schematic_mouse-tmb.png" alt="img"></a></p><p>Finally, the OLED screen needs connecting. We already did all the hard work calculating all the resistor values, so the schematic should be more or less self-explanatory. The chip added is a D-type flipflop and is used to halve the clock rate: as mentioned before the MIPI standard needs a new data bit every time the clock polarity inverts, while the ESP32 can only send out a new one on a raising or falling edge.<br><a href="https://spritesmods.com/minimacplus/schematic_oledclkdata.png"><img src="https://spritesmods.com/minimacplus/schematic_oledclkdata-tmb.png" alt="img"></a></p><p>With the schematic drawn, I moved on to the PCB artwork. The display I chose was meant to be mounted to its controlling PCB, with the connector on the backside of that PCB. While that would not leave much room for the other components, I still wanted to put all the other components on the other side.<br><a href="https://spritesmods.com/minimacplus/pcbs_empty.jpg"><img src="https://spritesmods.com/minimacplus/pcbs_empty-tmb.jpg" alt="img"></a></p><p>It’s a good thing I have a good pair of eyes and a hot-air rework station: this allowed me to use 0603 components which made everything fit cleanly on the limited PCB space. Especially the connector for the display and the QFN OLED power supply chip would be pretty hard to do with a normal soldering iron.</p><p>​                    <a href="https://spritesmods.com/minimacplus/pcb_populated.jpg"><img src="https://spritesmods.com/minimacplus/pcb_populated-tmb.jpg" alt="img"></a></p><p>For the mouse sensor and attached components, I figured out using a PCB would use up too much space. Instead, I opted to solder all components on the sensor itself, freeform style. This way, everything should be able to fit in the mouse.</p><p>​                    <a href="https://spritesmods.com/minimacplus/mousesensor.jpg"><img src="https://spritesmods.com/minimacplus/mousesensor-tmb.jpg" alt="img"></a></p><h1 id="Software"><a href="#Software" class="headerlink" title="Software"></a>Software</h1><p>​                                <a href="https://spritesmods.com/minimacplus/mac_poster.jpg"><img src="https://spritesmods.com/minimacplus/mac_poster-tmb.jpg" alt="img"></a></p><p>Now obviously, the software is a fairly big element of this build: the entire Macintosh needs to be emulated. The Macintosh, however, is not that complicated a machine. It essentially consists of the 68000 microcontroller, a Zilog Z8530 serial communications controller that controls the serial port, a 6522 VIA for some internal input and output and for interfacing with the keyboard and some random PALs containing the logic for the display and sound. There also is an Integrated Woz Machine-chip to interface with the floppy drive. This is a fairly complicated chip; however I was not planning to emulate a floppy so for emulation it would be enough to emulate an IWM that always returns that there’s no floppy in the drive. Instead, my plan was to fully emulate the NCR 5380 SCSI chip, connected to an emulated SCSI hard disk that would read from the onboard flash of the ESP32-Wrover module.</p><p>Furthermore, there are very few programs that attempt to access this hardware directly: programmers for the Mac were told from the start to use the OS-level hardware abstraction layers in order to stay compatible with later versions of the Mac hardware. In general, this means that when I succeeded emulating the hardware to a standard where the OS boots and stays happy, most programs would also run without complaints.</p><p>Because of this I decided I might as well program the emulator from scratch. Well, not entirely from scratch; the 68000 is a fairly complex beast and I didn’t feel like reinventing <em>that</em> particular wheel. Instead, I looked around on the Internet, and <a href="http://mamedev.org/">MAME</a> had a nice and quick C-based 68K emulator called Musashi that fit the bill nicely. It needed some slight mangling to put the lookup tables for the opcodes into flash instead of RAM, but otherwise it didn’t need much to port to the ESP32.</p><p>However, I wasn’t planning on developing the entire thing on the ESP32: while the chip has OpenOCD support allowing for a fair amount of debugging, the upload/test/fix/upload/… cycle would get pretty tedious. Instead, I decided to develop the thing on my Linux-machine first, keeping in mind the limits the ESP32 would eventually give me. So I went to work, using the datasheets for the various chips, the <a href="http://www.mac.linux-m68k.org/devel/plushw.php">Linux-68K</a> notes for the machine, as well as bits and pieces of the Inside Macintosh series that were floating around on the Internet. When I couldn’t find out from these what to do, I still had the option to sneak a peek under the hood of <a href="http://www.gryphel.com/c/minivmac/">other</a> <a href="http://www.hampa.ch/pce/pce-macplus.html">open-source</a> <a href="http://www.mess.org/mess/drivers/mac/macplus">emulators</a>.</p><p>Armed with all that, gcc as the C-compiler and libsdl as the library to get graphics going, I set to work. Long story short, some time later I ended up having a basic but mostly functional MacPlus emulator: mouse, video, SCSI hard disk and sound all worked:<br><a href="https://spritesmods.com/minimacplus/tme_booted.png"><img src="https://spritesmods.com/minimacplus/tme_booted-tmb.png" alt="img"></a></p><p>Because my hardware wasn’t done yet, I decided to port my emulator to an ESP-Wrover-Kit devboard. I had access to a few of these boards anyway, and apart from the Wrover module I was going to use anyway, it also had a nice 320x240 display I could use to see if video works.<br><a href="https://spritesmods.com/minimacplus/mac_wroom.jpg"><img src="https://spritesmods.com/minimacplus/mac_wroom-tmb.jpg" alt="img"></a></p><p>After some tweaking, the Mac emulator actually ran fairly well on this board; it usually comes pretty close to the 7.8MHz the Mac Plus normally runs at. (Actually, 7.8MHz would be slightly faster than a Mac Plus; because the frame buffer and sound system in the real thing eat up some of the memory cycles, the actual effective frequency could be as much as 35% lower.)</p><p>Obviously, getting the emulator working on a devboard is a nice step along the way, but in the end, the thing needs to run on the screen that I bought, not the devboard screen. And hold on a second, the devkit screen is 320x240 and cuts off a fair chunk of the Mac screen. The display I intend to use is 320x320 and as such only larger vertically: how am I going to get the 512x342 Mac screen displayed on it?</p><p>There’s one way to put 512x342 pixels onto a 320x320 screen, and that is scaling. Effectively, you take an image, then squish it to make it smaller, then you display it. However, scaling can be done in multiple ways and especially with a black-and-white image generated by an OS that assumes every pixel it set results in a clearly distinguishable point of light on the screen, there are multiple ways to do it badly. Effectively, I would like to lose as little resolution as possible. This means I needed to increase the resolution of my OLED.</p><p>But how do you do that? I can hardly open up the OLED screen and squish some more pixels in there. However, I don’t need to; the OLED display already has three times as many pixels as advertised. The reason for this is that the OLED screen is a color one: for each virtual ‘pixel’, it has a red, a green and a blue subpixel. Additionally, in this specific screen, the subpixels are laid out in triangles. To illustrate this, here’s a close-up of the screen, with three pixels lit:<br><a href="https://spritesmods.com/minimacplus/pixels.jpg"><img src="https://spritesmods.com/minimacplus/pixels-tmb.jpg" alt="img"></a></p><p>As you can see, the pixels are triangle-shaped sets of three subpixels; depending on the column they are on, the triangles either point up or down. This effectively means that our subpixel screen resolution is a nice 480 x 640 pixels instead. While still not entirely adequate for displaying 512x342 pixels, the difference is so small that with a small bit of well-chosen scaling the display looks as readable as an 1.63” display showing a GUI meant for a 9” screen will ever be:<br><a href="https://spritesmods.com/minimacplus/disp_scaled.jpg"><img src="https://spritesmods.com/minimacplus/disp_scaled_tmb.jpg" alt="img"></a></p><h1 id="Enclosure"><a href="#Enclosure" class="headerlink" title="Enclosure"></a>Enclosure</h1><p>So now I had a display, software that could emulate a Macintosh Plus fairly well, plus a microcontroller it could run on. What’s still missing? A nice box to put it in, obviously!</p><p>I decided to 3d-print one on the nice Formlabs 1+ SLA printer my work has. To do this, I first needed a model. I wanted to build one from scratch. Obviously, to do this it would be best if I had a real Macintosh Plus at my disposal. I actually have one in my posession, but it was half a continent away… Luckily, I could get my hands on the next best thing: some kind soul uploaded the dimensions of an original Mac 128K (which has almost the same case as the Plus) to the <a href="https://www.ifixit.com/Wiki/Macintosh_128K_Dimensions">iFixit</a> wiki.</p><p>I still do all my 3d modeling in OpenScad, and after some sweating and cursing to get all the curves looking like they should, I had a nice model of an 1-to-6-scale Mac. <a href="https://spritesmods.com/minimacplus/scad.jpg"><img src="https://spritesmods.com/minimacplus/scad-tmb.jpg" alt="img"></a></p><p>The mouse was also created from the iFixit images, but because it needed to fit the (relatively large) optical mouse sensor, unfortunately it couldn’t be scaled to 1/6th of the real thing. The scale is more like 2/5th, making it seem somewhat large next to the tiny Mac but also making it way more usable for non-scaled-down human fingers.</p><p><a href="https://spritesmods.com/minimacplus/scad_mouse.png"><img src="https://spritesmods.com/minimacplus/scad_mouse-tmb.png" alt="img"></a></p><p>So now all that remained was to print the thing. I exported the design as various STL files and used the Formlabs 1+ to print them. This went fairly well, althought the resin was somewhat old so I put a few more supports than the default in to make sure I wouldn’t get a mis-print. The end result came out pretty nice; the only regret I have is that I didn’t put locking clips for the two halves in the design. I eventually worked around that by just sealing the two halves together using a drop of superglue.<br><a href="https://spritesmods.com/minimacplus/case_done.jpg"><img src="https://spritesmods.com/minimacplus/case_done_tmb.jpg" alt="img"></a></p><h1 id="Result"><a href="#Result" class="headerlink" title="Result"></a>Result</h1><p>So, I had all the parts and I just needed to click them together. The PCB slots in the front of the case, where a few clips hold it in. The usb-to-serial converter, used as an upload mechanism and a power supply, slot into the back bit and is also held by a few clips. I forgot to make something to hold the speaker in, but some superglue can easily affix it inside the case. Finally, the mouse is connected using a bundle of thin wires. (And yes, they kind-of clash with the color scheme… as soon as I find a nicer, thin multi-core cable I’ll replace it with that.)</p><p><a href="https://spritesmods.com/minimacplus/done.jpg"><img src="https://spritesmods.com/minimacplus/done-tmb.jpg" alt="img"></a></p><p>Now, when designing things on a computer in order to have them materialize in full later on, like what happens when you finally receive those PCBs from the factory or when your 3d-printer finishes printing that design you worked for weeks on, is the scale of the thing. Obviously, I knew that all sizes would be 1/6th of a real Mac, but only when everything was put together and I saw the thing in real life, the implications of this showed. The Mac truly is tiny!<br><a href="https://spritesmods.com/minimacplus/tiny.jpg"><img src="https://spritesmods.com/minimacplus/tiny_tmb.jpg" alt="img"></a> <a href="https://spritesmods.com/minimacplus/mac_full2.jpg"><img src="https://spritesmods.com/minimacplus/mac_full2_tmb.jpg" alt="img"></a></p><p>And even with its minute size and lack of a keyboard, it does run most of the things the Mac is well-known for. Here is a demonstration. The first 20 seconds are the memory test, and I know from experience the test lasting this long is not a bug: it took our original Mac Plus that long to boot as well after we upgraded it.</p><p>So, what good is this Mac Plus in the end? Admittently, while I had a blast making it, without a keyboard it can’t really serve a real purpose. Also, it has no connectivity to speak of: I planned to make it do AppleTalk over WiFi, but I failed because of some weirdnesses I couldn’t emulate right in the serial controller chip of the original Mac. Still, with the project finished in the state it is, I can finally live my lifelong dream to have a Mac on my desk displaying the original After Dark flying toasters:<br><img src="https://spritesmods.com/minimacplus/toaster-optimized.gif" alt="img"></p><p>As always, this project is open-source, and the PCB artwork as well as the case design and the firmware are up on <a href="https://github.com/Spritetm/minimacplus">Github</a>. Everything is licensed under the Beer-Ware license so you can mostly do with it what you want. If you ever use it in something, I’d really appreciate a [note](<a href="http://spritesmods.com/?art=contact&amp;af=Miniature">http://spritesmods.com/?art=contact&amp;af=Miniature</a> Macintosh Plus), however.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;参考：&lt;a href=&quot;https://spritesmods.com/?art=minimacplus&quot;&gt;Sprites mods - Miniature Macintosh Plus - Intro&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
</summary>
      
    
    
    
    <category term="搬运" scheme="https://ljweb.xyz/categories/%E6%90%AC%E8%BF%90/"/>
    
    
    <category term="diy" scheme="https://ljweb.xyz/tags/diy/"/>
    
  </entry>
  
  <entry>
    <title>锂电池电压测量电路设计</title>
    <link href="https://ljweb.xyz/2021/11/24/%E9%94%82%E7%94%B5%E6%B1%A0%E7%94%B5%E5%8E%8B%E6%B5%8B%E9%87%8F%E7%94%B5%E8%B7%AF%E8%AE%BE%E8%AE%A1/"/>
    <id>https://ljweb.xyz/2021/11/24/%E9%94%82%E7%94%B5%E6%B1%A0%E7%94%B5%E5%8E%8B%E6%B5%8B%E9%87%8F%E7%94%B5%E8%B7%AF%E8%AE%BE%E8%AE%A1/</id>
    <published>2021-11-24T17:36:05.000Z</published>
    <updated>2022-02-16T14:10:43.468Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>参考：</p><p>&emsp;&emsp;1.<a href="https://oshwhub.com/article/li-dian-chi-dian-ya-ce-liang-dian-lu-she-jin">锂电池电压测量电路设计 - 立创EDA开源硬件平台 (oshwhub.com)</a></p><p>&emsp;&emsp;2.<a href="https://rationmcu.com/elecjc/3831.html">锂电池电压测量电路设计 – 瑞生网 (rationmcu.com)</a></p></blockquote><p>&emsp;&emsp;先补充一下锂电池的基本知识</p><p>&emsp;&emsp; 锂电池在充满电的时候，是4.2V；在用完电的时候，不是0V，而是2.7V左右，每个厂家制作的锂电池，略有差异。鉴于锂电池材料的局限性，电压超过4.2V，会发生危险，比如燃烧；电压低于2.7V左右，会造成无法再次充电，总之…锂电池电压过高和过低，都会造成永久损坏。所以，我们的产品在使用锂电池的时候，需要时刻监测锂电池电压。</p><p>&emsp;&emsp;充电的时候，不要超过4.2V，这个要求，需要产品中加入充电管理芯片，充电管理芯片会自动在4.2V的时候切断充电。放电的时候，也就是产品在正常使用的时候，不要让锂电池电压低于2.7V，比如，在2.7V的时候，自动强制关机。</p><p>&emsp;&emsp;那么，锂电池电压监测电路应该怎么设计呢？</p><p><img src="/2021/11/24/%E9%94%82%E7%94%B5%E6%B1%A0%E7%94%B5%E5%8E%8B%E6%B5%8B%E9%87%8F%E7%94%B5%E8%B7%AF%E8%AE%BE%E8%AE%A1/image.png" alt="img"></p><p>&emsp;&emsp;如上图所示，应该是初学者最先想到的办法。不过，仔细分析后会发现，有大问题，我们来分析一下。</p><p>&emsp;&emsp;VBAT连接到锂电池正极，通过两个电阻分压，连接到单片机的ADC引脚。ADC测到的电压，就是锂电池电压的一半。因为锂电池的电压范围大概在2.7V到4.2V之间，所以ADC引脚的电压会在1.35~2.1V之间，不会超过普通单片机的3.3V电压，看起来很合理，不过，当产品处于关机状态时，我们以为锂电池就不耗电了，其实，通过电路可以发现，锂电池其实还在通过2个10k的电阻耗电。随着时间的推移，该产品放着放着电就减少了，而且当电池电压减少到2.7V以下时，就可能无法充起电来了。</p><p>&emsp;&emsp; 我在国外的一款产品上，看到了这样的一个电路，当然，已经把它使用到我的产品当中。</p><p><img src="/2021/11/24/%E9%94%82%E7%94%B5%E6%B1%A0%E7%94%B5%E5%8E%8B%E6%B5%8B%E9%87%8F%E7%94%B5%E8%B7%AF%E8%AE%BE%E8%AE%A1/image-1.png" alt="img"></p><p>&emsp;&emsp;上面电路，很巧妙的解决了这个问题，代价是电路板上多了1个MOS管和2个电阻，CTRL引脚是单片机的一个普通引脚，在单片机断电的时候，要求是高阻态，否则也会耗电！·这里加MOS管并不是用来控制“是否要测量电池电压”，而是为了在产品关机的时候，不要让锂电池电池的电压通过两个分压电阻。</p><p>&emsp;&emsp;此时，还有个问题要解决。</p><p>&emsp;&emsp;产品在正常使用的过程中，当电池电压小于3.3V时，LDO的输出电压，就不再是3.3V了，随着电池电压的减小，LDO的输出电压也会减小，此时…</p><p>如果一直使用3.3V作为基准来测量电池电压，就会出现错误，所以，需要使用有基准电压引脚的单片机，或者有“内部参考电压”+“内部测量通道”功能的单片机</p><p>用基准电压引脚计算电池电压，这个大家都清楚，我重点说一下“内部参考电压”+“内部测量通道”这个功能。</p><p>&emsp;&emsp;简单来说，有了“内部参考电压”+“内部测量通道”之后，我们就可以直接通过内部测量通道得到精确的VDD电压，而不必使用基准电压芯片了，毕竟，基准电压芯片也挺贵的，还得在电路板上占个地方，以及多几分钱的焊接费用。</p><p>&emsp;&emsp;下面，我们以STC8G系列单片机为例来说一下。</p><p>&emsp;&emsp;STC8G的ADC第15通道，用来测量内部参考电压源，内部参考电压为1.19V，通过测量它的值，反推出VDD值。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> VDDA; <span class="comment">// VDDA的电压值 单位毫伏</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> *BGV; <span class="comment">// 内部参考电压值 单位毫伏</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ADC初始化</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ADC_Init</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  BGV = (<span class="keyword">int</span> idata *)<span class="number">0xEF</span>;</span><br><span class="line">  ADCCFG = <span class="number">0X2F</span>; <span class="comment">// 设置ADC时钟 = 24000000/2/16/512 = 1465Hz 转换结果右对齐</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="title">ADCRead</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> res;</span><br><span class="line"></span><br><span class="line">  ADC_CONTR |= <span class="number">0X40</span>; <span class="comment">// 启动AD转换</span></span><br><span class="line">  _nop_();</span><br><span class="line">  _nop_();</span><br><span class="line">  <span class="keyword">while</span>(!(ADC_CONTR&amp;<span class="number">0X20</span>)); <span class="comment">// 查询ADC完成标志</span></span><br><span class="line">  ADC_CONTR &amp;= ~<span class="number">0X20</span>;  <span class="comment">// 清除完成标志</span></span><br><span class="line">  res = (ADC_RES&lt;&lt;<span class="number">8</span>)|ADC_RESL; <span class="comment">//读取ADC结果</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Fetch_VDDA</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> res=<span class="number">0</span>;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">char</span> i;</span><br><span class="line"></span><br><span class="line">  ADC_CONTR = <span class="number">0X8F</span>; <span class="comment">// 使能ADC模块 并选择第15通道</span></span><br><span class="line">  ADCRead();</span><br><span class="line">  ADCRead();</span><br><span class="line">  <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">8</span>;i++)</span><br><span class="line">  &#123;</span><br><span class="line">    res+=ADCRead();</span><br><span class="line">  &#125;</span><br><span class="line">  res&gt;&gt;=<span class="number">3</span>; <span class="comment">// 读取8次 取平均值</span></span><br><span class="line">  VDDA = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(<span class="number">1023L</span>**BGV/res); <span class="comment">// 得出的结果单位是毫伏</span></span><br><span class="line">&#125;上面代码，获得了真实的VDDA值，然后就可以计算出真实的电池电压。</span><br></pre></td></tr></table></figure><p>本文摘自瑞生网，<a href="https://rationmcu.com/elecjc/3831.html">点击查看原链接</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;参考：&lt;/p&gt;
&lt;p&gt;&amp;emsp;&amp;emsp;1.&lt;a href=&quot;https://oshwhub.com/article/li-dian-chi-dian-ya-ce-liang-dian-lu-she-jin&quot;&gt;锂电池电压测量电路设计 - 立创</summary>
      
    
    
    
    <category term="学习笔记" scheme="https://ljweb.xyz/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
  </entry>
  
  <entry>
    <title>大功率直流有刷电机驱动设计</title>
    <link href="https://ljweb.xyz/2021/11/24/%E5%A4%A7%E5%8A%9F%E7%8E%87%E7%9B%B4%E6%B5%81%E6%9C%89%E5%88%B7%E7%94%B5%E6%9C%BA%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1/"/>
    <id>https://ljweb.xyz/2021/11/24/%E5%A4%A7%E5%8A%9F%E7%8E%87%E7%9B%B4%E6%B5%81%E6%9C%89%E5%88%B7%E7%94%B5%E6%9C%BA%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1/</id>
    <published>2021-11-24T17:09:04.000Z</published>
    <updated>2022-02-16T14:10:43.384Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>参考：</p><p>&emsp;&emsp;1.<a href="https://blog.csdn.net/qq_42059060/article/details/103498076">IR2104驱动原理_ChenYX的博客-CSDN博客</a></p><p>&emsp;&emsp;2.<a href="https://oshwhub.com/JHO_o/4833n-mos-zhi-liu-dian-ji-qu-dong-ban">4833N，MOS， 直流电机驱动板 - 立创EDA开源硬件平台 (oshwhub.com)</a></p><p>&emsp;&emsp;3.<a href="https://oshwhub.com/skqinghuan/BTN8982shuang-lu-da-dian-liu-dia">BTN8982双路大电流电机驱动 - 立创EDA开源硬件平台 (oshwhub.com)</a></p><p>&emsp;&emsp;4.<a href="https://oshwhub.com/ni-hao-ke-ji/h-qiao-dian-ji-qu-dong_v1-0_copy">大电流双路直流电机驱动 H桥 MOS管 【低创】 【高性价比】 - 立创EDA开源硬件平台 (oshwhub.com)</a></p><p>&emsp;&emsp;5.<a href="https://oshwhub.com/STM32EDA/BTN7971Bmu-kuai-_da-gong-shuai-H">BTN7971B模块_大功率H桥驱动器 - 立创EDA开源硬件平台 (oshwhub.com)</a></p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;参考：&lt;/p&gt;
&lt;p&gt;&amp;emsp;&amp;emsp;1.&lt;a href=&quot;https://blog.csdn.net/qq_42059060/article/details/103498076&quot;&gt;IR2104驱动原理_ChenYX的博客-CSDN博客&lt;/</summary>
      
    
    
    
    <category term="智能车" scheme="https://ljweb.xyz/categories/%E6%99%BA%E8%83%BD%E8%BD%A6/"/>
    
    
    <category term="电路" scheme="https://ljweb.xyz/tags/%E7%94%B5%E8%B7%AF/"/>
    
  </entry>
  
  <entry>
    <title>linux学习笔记</title>
    <link href="https://ljweb.xyz/2021/11/24/linux%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <id>https://ljweb.xyz/2021/11/24/linux%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</id>
    <published>2021-11-24T16:00:10.000Z</published>
    <updated>2022-02-16T14:10:43.384Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>参考：<a href="https://blog.csdn.net/qq_23329167/article/details/83856430"> Linux常用命令_Demon的博客-CSDN博客_linux常用命令</a></p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;参考：&lt;a href=&quot;https://blog.csdn.net/qq_23329167/article/details/83856430&quot;&gt; Linux常用命令_Demon的博客-CSDN博客_linux常用命令&lt;/a&gt;&lt;/p&gt;
&lt;/block</summary>
      
    
    
    
    <category term="学习笔记" scheme="https://ljweb.xyz/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
  </entry>
  
  <entry>
    <title>git学习笔记</title>
    <link href="https://ljweb.xyz/2021/11/22/git%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <id>https://ljweb.xyz/2021/11/22/git%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</id>
    <published>2021-11-22T17:37:08.000Z</published>
    <updated>2022-02-16T14:10:43.384Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>参考：<a href="https://fushaolei.github.io/post/git-note/">Git学习笔记 (fushaolei.github.io)</a></p></blockquote><h3 id="🤳常用指令"><a href="#🤳常用指令" class="headerlink" title="🤳常用指令"></a>🤳常用指令</h3><p><a href="https://fushaolei.github.io/post/git-note/">Git学习笔记 (fushaolei.github.io)</a></p><table><thead><tr><th align="left">指令</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left"><code>git init</code></td><td align="left">初始化</td></tr><tr><td align="left"><code>git add .</code></td><td align="left">将修改放入暂存区</td></tr><tr><td align="left"><code>git status</code></td><td align="left">查看状态</td></tr><tr><td align="left"><code>git log</code></td><td align="left">可以查看有几个版本提交到仓库里</td></tr><tr><td align="left"><code>git reset --hard 版本号</code></td><td align="left">版本回退，hard强制回退，soft的话会保留修改</td></tr><tr><td align="left"><code>git stash</code></td><td align="left">将修改保存起来</td></tr><tr><td align="left"><code>git stash save &quot;xxx&quot;</code></td><td align="left">将修改保存起来，并设置这个保存的标签</td></tr><tr><td align="left"><code>git stash apply stash@&#123;x&#125;</code></td><td align="left">将修改移出来</td></tr><tr><td align="left"><code>git branch -vv</code></td><td align="left">查看本地分支是否与远端分支建立了连接</td></tr><tr><td align="left"><code>git push origin &lt;分支名&gt;:&lt;分支名&gt;</code></td><td align="left">仅仅将本地分支推送到远端分支， <strong>注意:这个操作只是单纯的把本地的分支推送到远端,尚未建立连接</strong></td></tr><tr><td align="left"><code>git remote</code></td><td align="left">查看远程库的信息，用<code>git remote -v</code>可以看到更详细的信息</td></tr><tr><td align="left"><code>git pull --rebase origin master</code></td><td align="left">和远程仓库进行一个同步</td></tr></tbody></table>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;参考：&lt;a href=&quot;https://fushaolei.github.io/post/git-note/&quot;&gt;Git学习笔记 (fushaolei.github.io)&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;🤳常用指令&quot;&gt;</summary>
      
    
    
    
    <category term="学习笔记" scheme="https://ljweb.xyz/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="教程" scheme="https://ljweb.xyz/tags/%E6%95%99%E7%A8%8B/"/>
    
    <category term="git" scheme="https://ljweb.xyz/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>使用GitHubAction实现hexo在线写作</title>
    <link href="https://ljweb.xyz/2021/11/22/%E4%BD%BF%E7%94%A8GitHubAction%E5%AE%9E%E7%8E%B0hexo%E5%9C%A8%E7%BA%BF%E5%86%99%E4%BD%9C/"/>
    <id>https://ljweb.xyz/2021/11/22/%E4%BD%BF%E7%94%A8GitHubAction%E5%AE%9E%E7%8E%B0hexo%E5%9C%A8%E7%BA%BF%E5%86%99%E4%BD%9C/</id>
    <published>2021-11-22T16:56:51.000Z</published>
    <updated>2022-02-16T14:10:43.384Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>参考：<a href="https://blog.csdn.net/qq_41426117/article/details/108703295?ops_request_misc=%7B%22request_id%22:%22163759195116780271594253%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=163759195116780271594253&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~baidu_landing_v2~default-4-108703295.pc_search_mgc_flag&utm_term=hexo%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91&spm=1018.2226.3001.4187">GitHub Action + Hexo实现在线写作_磊少1999的博客-CSDN博客</a></p></blockquote><p>&emsp;&emsp;建一个新的仓库给hexo放源文件，然后使用GitHub Action：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># workflow name</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">Hexo</span> <span class="string">Blog</span> <span class="string">CI</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># master branch on push, auto run</span></span><br><span class="line"><span class="attr">on:</span> </span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">master</span></span><br><span class="line">      </span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">build:</span> </span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span> </span><br><span class="line">        </span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">    <span class="comment"># check it to your workflow can access it</span></span><br><span class="line">    <span class="comment"># from: https://github.com/actions/checkout</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Checkout</span> <span class="string">Repository</span> <span class="string">master</span> <span class="string">branch</span></span><br><span class="line">      <span class="attr">uses:</span> <span class="string">actions/checkout@master</span> </span><br><span class="line">      </span><br><span class="line">    <span class="comment"># from: https://github.com/actions/setup-node  </span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Setup</span> <span class="string">Node.js</span> <span class="number">12.</span><span class="string">x</span> </span><br><span class="line">      <span class="attr">uses:</span> <span class="string">actions/setup-node@master</span></span><br><span class="line">      <span class="attr">with:</span></span><br><span class="line">        <span class="attr">node-version:</span> <span class="string">&quot;12.x&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Setup</span> <span class="string">Hexo</span> <span class="string">Dependencies</span></span><br><span class="line">      <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">        npm install hexo-cli -g</span></span><br><span class="line"><span class="string">        npm install</span></span><br><span class="line"><span class="string"></span>    </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Setup</span> <span class="string">Deploy</span> <span class="string">Private</span> <span class="string">Key</span></span><br><span class="line">      <span class="attr">env:</span></span><br><span class="line">        <span class="attr">HEXO_DEPLOY_PRIVATE_KEY:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.HEXO_DEPLOY_PRIVATE_KEY</span> <span class="string">&#125;&#125;</span></span><br><span class="line">      <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">        mkdir -p ~/.ssh/</span></span><br><span class="line"><span class="string">        echo &quot;$HEXO_DEPLOY_PRIVATE_KEY&quot; &gt; ~/.ssh/id_rsa </span></span><br><span class="line"><span class="string">        chmod 600 ~/.ssh/id_rsa</span></span><br><span class="line"><span class="string">        ssh-keyscan github.com &gt;&gt; ~/.ssh/known_hosts</span></span><br><span class="line"><span class="string"></span>        </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Setup</span> <span class="string">Git</span> <span class="string">Infomation</span></span><br><span class="line">      <span class="attr">run:</span> <span class="string">| </span></span><br><span class="line"><span class="string">        git config --global user.name &#x27;&lt;你的用户名&gt;&#x27; </span></span><br><span class="line"><span class="string">        git config --global user.email &#x27;&lt;你登录的email&gt;&#x27;</span></span><br><span class="line"><span class="string"></span>    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Deploy</span> <span class="string">Hexo</span> </span><br><span class="line">      <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">        hexo clean</span></span><br><span class="line"><span class="string">        hexo generate </span></span><br><span class="line"><span class="string">        hexo deploy</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;参考：&lt;a href=&quot;https://blog.csdn.net/qq_41426117/article/details/108703295?ops_request_misc=%7B%22request_id%22:%22163759195116</summary>
      
    
    
    
    <category term="教程" scheme="https://ljweb.xyz/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="教程" scheme="https://ljweb.xyz/tags/%E6%95%99%E7%A8%8B/"/>
    
    <category term="git" scheme="https://ljweb.xyz/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>hexo首行缩进不显示解决方法</title>
    <link href="https://ljweb.xyz/2021/11/21/hexo%E9%A6%96%E8%A1%8C%E7%BC%A9%E8%BF%9B%E4%B8%8D%E6%98%BE%E7%A4%BA%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/"/>
    <id>https://ljweb.xyz/2021/11/21/hexo%E9%A6%96%E8%A1%8C%E7%BC%A9%E8%BF%9B%E4%B8%8D%E6%98%BE%E7%A4%BA%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/</id>
    <published>2021-11-21T13:57:20.000Z</published>
    <updated>2022-02-16T14:10:43.384Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>&emsp;&emsp;通过Markdown写的文章转换成HTML后首行没有缩进2格，即使在Typora中显示有缩进（自己多敲了几个空格或者Tap键），这种原因是Markdown对中文的支持不全导致的。</p><p>参考：<a href="https://blog.csdn.net/Reign_Man/article/details/112096540"> Markdown首行缩进解决方法实例_DC-CSDN博客</a></p></blockquote><p>解决方法:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">用 &amp;emsp; 代替空格</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;&amp;emsp;&amp;emsp;通过Markdown写的文章转换成HTML后首行没有缩进2格，即使在Typora中显示有缩进（自己多敲了几个空格或者Tap键），这种原因是Markdown对中文的支持不全导致的。&lt;/p&gt;
&lt;p&gt;参考：&lt;a href=&quot;htt</summary>
      
    
    
    
    <category term="教程" scheme="https://ljweb.xyz/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="教程" scheme="https://ljweb.xyz/tags/%E6%95%99%E7%A8%8B/"/>
    
    <category term="typora" scheme="https://ljweb.xyz/tags/typora/"/>
    
  </entry>
  
  <entry>
    <title>立创训练营esp32数码管时钟</title>
    <link href="https://ljweb.xyz/2021/11/21/%E7%AB%8B%E5%88%9B%E8%AE%AD%E7%BB%83%E8%90%A5esp32%E6%95%B0%E7%A0%81%E7%AE%A1%E6%97%B6%E9%92%9F/"/>
    <id>https://ljweb.xyz/2021/11/21/%E7%AB%8B%E5%88%9B%E8%AE%AD%E7%BB%83%E8%90%A5esp32%E6%95%B0%E7%A0%81%E7%AE%A1%E6%97%B6%E9%92%9F/</id>
    <published>2021-11-21T09:05:11.000Z</published>
    <updated>2022-02-16T14:10:43.468Z</updated>
    
    <content type="html"><![CDATA[<p>&emsp;&emsp;最近参加了学校实验室的立创训练营项目，项目是做一个物联网的时钟，还是比较简单的一个项目，使用的是ESP32-C3模组，两个四位数码管来显示时间，MAX7219驱动数码管，DS1302时钟芯片提供时间，然后还有五个按键。一个程序下载按键，一个RST按键，还有三个功能按键。</p><p><img src="https://image.lceda.cn/pullimage/rr0wkYCOCrZKXoptxBP4ylRRHaOQrjIbqBlGyswz.jpeg" alt="img"></p><p>&emsp;&emsp;硬件上来说还是很简单的。我在此基础上添加了锂电池充放电管理，使用的是TP4054这颗充电IC外围电路非常少，因为目前我还不会其他的充电电路，就只能先用这个了，这颗芯片带一个充电指示引脚，连一颗LED就能指示充电了。我还加了个SHT30温湿度传感器，然后把DS1302换成了PCF8563，这颗时钟芯片与单片机使用I2C通信，程序设计上要稍微复杂些，SHT30也是用 I2C 通信的， I2C 确实比较神奇，我复用了两个引脚来连接这两颗芯片。    </p><img src="https://image.lceda.cn/avatars/2021/10/OUCWNn8QNme06G4Ri2w4R79U3PA1vtl94PF3kFbC.png" alt="img" style="zoom:115%;"><p>&emsp;&emsp;这次使用立创EDA进行电路、PCB设计：<a href="https://oshwhub.com/admin3075/ji-yuesp32-di-wu-lian-wang-shi-zhong">项目开源链接</a></p><p>&emsp;&emsp;软件上本来打算用ESP-IDF的，可是配置起来麻烦的很，所以最后我还是用我目前比较熟悉的arduino来实现的。打算以后有时间再来用ESP-IDF。 </p><h2 id="1-arduino参考代码"><a href="#1-arduino参考代码" class="headerlink" title="1.arduino参考代码"></a>1.arduino参考代码</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;NTPClient.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Ds1302.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span>* ssid     = <span class="string">&quot;ssid&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span>* password = <span class="string">&quot;password&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> CLK = <span class="number">7</span>;</span><br><span class="line"><span class="keyword">int</span> CS = <span class="number">6</span>;</span><br><span class="line"><span class="keyword">int</span> DIN = <span class="number">4</span>; <span class="comment">//这里定义了那三个脚</span></span><br><span class="line"><span class="keyword">int</span> sw1=<span class="number">18</span>;<span class="comment">//拨轮按键</span></span><br><span class="line"><span class="keyword">int</span> sw2=<span class="number">19</span>;</span><br><span class="line"><span class="keyword">int</span> sw3=<span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> sec;</span><br><span class="line"> <span class="keyword">int</span> n=<span class="number">10</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> battery 0</span></span><br><span class="line">WiFiUDP ntpUDP; </span><br><span class="line"><span class="function">NTPClient <span class="title">timeClient</span><span class="params">(ntpUDP, <span class="string">&quot;ntp1.aliyun.com&quot;</span>, <span class="number">60</span>*<span class="number">60</span>*<span class="number">8</span>, <span class="number">30</span>*<span class="number">60</span>*<span class="number">1000</span>)</span></span>;</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">smgdispaly</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(sec!=timeClient.getSeconds())&#123;</span><br><span class="line">  <span class="keyword">int</span> h1,h2,m1,m2,s1,s2;</span><br><span class="line">  h1=timeClient.getHours()/<span class="number">10</span>;</span><br><span class="line">  h2=timeClient.getHours()%<span class="number">10</span>;</span><br><span class="line">  m1=timeClient.getMinutes()/<span class="number">10</span>;</span><br><span class="line">  m2=timeClient.getMinutes()%<span class="number">10</span>;</span><br><span class="line">  s1=timeClient.getSeconds()/<span class="number">10</span>;</span><br><span class="line">  s2=timeClient.getSeconds()%<span class="number">10</span>;</span><br><span class="line">   Write_Max7219(<span class="number">0x0f</span>, <span class="number">0x00</span>);       <span class="comment">//显示测试：1；测试结束，正常显示：0</span></span><br><span class="line">   Write_Max7219(<span class="number">1</span>,h1);</span><br><span class="line">   Write_Max7219(<span class="number">2</span>,h2);</span><br><span class="line">   Write_Max7219(<span class="number">4</span>,m1); </span><br><span class="line">   Write_Max7219(<span class="number">5</span>,m2);</span><br><span class="line">   Write_Max7219(<span class="number">7</span>,s1);</span><br><span class="line">   Write_Max7219(<span class="number">8</span>,s2);</span><br><span class="line">   sec=timeClient.getSeconds();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">batterydisplay</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">float</span> analog_value = <span class="number">0</span>;</span><br><span class="line">     analog_value = analogRead(battery);</span><br><span class="line">     delay(<span class="number">1000</span>);</span><br><span class="line">     Serial.<span class="built_in">printf</span>(<span class="string">&quot;Current Reading on Pin(%d)=%f\n&quot;</span>,battery,analog_value*<span class="number">4.2</span>/<span class="number">2910</span>);</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">switchkey</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(digitalRead(sw2)==LOW)&#123;</span><br><span class="line">    delay(<span class="number">10</span>);</span><br><span class="line">    <span class="keyword">if</span>(digitalRead(sw2)==LOW)&#123;</span><br><span class="line">      Serial.println(n);</span><br><span class="line">      Write_Max7219(<span class="number">0x09</span>, <span class="number">0xff</span>); </span><br><span class="line">      Write_Max7219(<span class="number">0x0a</span>, n++);</span><br><span class="line">       <span class="keyword">if</span>(n&gt;=<span class="number">15</span>) n=<span class="number">15</span>;</span><br><span class="line">     &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(digitalRead(sw3)==LOW)&#123;</span><br><span class="line">      delay(<span class="number">10</span>);</span><br><span class="line">        <span class="keyword">if</span>(digitalRead(sw3)==LOW)&#123;</span><br><span class="line">          Serial.println(n);</span><br><span class="line">          Write_Max7219(<span class="number">0x09</span>, <span class="number">0xff</span>); </span><br><span class="line">          Write_Max7219(<span class="number">0x0a</span>, n--);</span><br><span class="line">          <span class="keyword">if</span>(n&lt;=<span class="number">0</span>) n=<span class="number">0</span>;          </span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;  <span class="comment">// put your setup code here, to run once:</span></span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">  pinMode(CLK,OUTPUT);</span><br><span class="line">  pinMode(CS,OUTPUT);</span><br><span class="line">  pinMode(DIN,OUTPUT); <span class="comment">//让三个脚都是输出状态</span></span><br><span class="line">  </span><br><span class="line">  pinMode(battery,INPUT);</span><br><span class="line">  </span><br><span class="line">  pinMode(sw1,INPUT_PULLUP);</span><br><span class="line">  pinMode(sw2,INPUT_PULLUP);</span><br><span class="line">  pinMode(sw3,INPUT_PULLUP);</span><br><span class="line">  </span><br><span class="line">  Init_MAX7219();</span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line">    <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">        delay(<span class="number">500</span>);</span><br><span class="line">        Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;WiFi connected&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP());</span><br><span class="line">  timeClient.begin();</span><br><span class="line">  sec=timeClient.getSeconds();</span><br><span class="line">   Serial.println(timeClient.getFormattedTime());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">// put your main code here, to run repeatedly:</span></span><br><span class="line">   timeClient.update();</span><br><span class="line">   smgdispaly();</span><br><span class="line">   switchkey();</span><br><span class="line">    delay(<span class="number">50</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Delay_xms</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> i,j;</span><br><span class="line">  <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;x;i++)</span><br><span class="line">  <span class="keyword">for</span>(j=<span class="number">0</span>;j&lt;<span class="number">112</span>;j++);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//--------------------------------------------</span></span><br><span class="line"><span class="comment">//功能：向MAX7219写入字节</span></span><br><span class="line"><span class="comment">//入口参数：DATA </span></span><br><span class="line"><span class="comment">//出口参数：无</span></span><br><span class="line"><span class="comment">//说明：</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Write_Max7219_byte</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> DATA)</span>         </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> i;    </span><br><span class="line">    digitalWrite(CS,LOW);                </span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">8</span>;i&gt;=<span class="number">1</span>;i--)</span><br><span class="line">    &#123;                  </span><br><span class="line">      digitalWrite(CLK,LOW);    </span><br><span class="line">      <span class="keyword">if</span>(DATA&amp;<span class="number">0X80</span>)</span><br><span class="line">           digitalWrite(DIN,HIGH);</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">           digitalWrite(DIN,LOW);</span><br><span class="line">      DATA&lt;&lt;=<span class="number">1</span>;</span><br><span class="line">      digitalWrite(CLK,HIGH);</span><br><span class="line">     &#125;                                 </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//-------------------------------------------</span></span><br><span class="line"><span class="comment">//功能：向MAX7219写入数据</span></span><br><span class="line"><span class="comment">//入口参数：address、dat</span></span><br><span class="line"><span class="comment">//出口参数：无</span></span><br><span class="line"><span class="comment">//说明：</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Write_Max7219</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> address,<span class="keyword">unsigned</span> <span class="keyword">char</span> dat)</span></span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">   digitalWrite(CS,LOW);</span><br><span class="line">   Write_Max7219_byte(address);           <span class="comment">//写入地址，即数码管编号</span></span><br><span class="line">   Write_Max7219_byte(dat);               <span class="comment">//写入数据，即数码管显示数字 </span></span><br><span class="line">   digitalWrite(CS,HIGH);                        </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Init_MAX7219</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   Write_Max7219(<span class="number">0x09</span>, <span class="number">0xff</span>);       <span class="comment">//译码方式：BCD码</span></span><br><span class="line">   Write_Max7219(<span class="number">0x0a</span>, <span class="number">15</span>);       <span class="comment">//亮度</span></span><br><span class="line">   Write_Max7219(<span class="number">0x0b</span>, <span class="number">0x07</span>);       <span class="comment">//扫描界限；4个数码管显示</span></span><br><span class="line">   Write_Max7219(<span class="number">0x0c</span>, <span class="number">0x01</span>);       <span class="comment">//掉电模式：0，普通模式：1</span></span><br><span class="line">   Write_Max7219(<span class="number">1</span>,<span class="number">0xa</span>);</span><br><span class="line">   Write_Max7219(<span class="number">2</span>,<span class="number">0xa</span>);</span><br><span class="line">   Write_Max7219(<span class="number">3</span>,<span class="number">0xa</span>);</span><br><span class="line">   Write_Max7219(<span class="number">4</span>,<span class="number">0xa</span>);</span><br><span class="line">   Write_Max7219(<span class="number">5</span>,<span class="number">0xa</span>);</span><br><span class="line">   Write_Max7219(<span class="number">6</span>,<span class="number">0xa</span>);</span><br><span class="line">   Write_Max7219(<span class="number">7</span>,<span class="number">0xa</span>);</span><br><span class="line">   Write_Max7219(<span class="number">8</span>,<span class="number">0xa</span>);</span><br><span class="line">   delay(<span class="number">100</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-ESP-IDF正在尝试中……"><a href="#2-ESP-IDF正在尝试中……" class="headerlink" title="2.ESP-IDF正在尝试中……"></a>2.ESP-IDF正在尝试中……</h2><blockquote><p>参考：<a href="https://docs.espressif.com/projects/esp-idf/zh_CN/latest/esp32/get-started/index.html">快速入门 - ESP32 - — ESP-IDF 编程指南 latest 文档 (espressif.com)</a></p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&amp;emsp;&amp;emsp;最近参加了学校实验室的立创训练营项目，项目是做一个物联网的时钟，还是比较简单的一个项目，使用的是ESP32-C3模组，两个四位数码管来显示时间，MAX7219驱动数码管，DS1302时钟芯片提供时间，然后还有五个按键。一个程序下载按键，一个RST按键</summary>
      
    
    
    
    <category term="arduino" scheme="https://ljweb.xyz/categories/arduino/"/>
    
    
    <category term="diy" scheme="https://ljweb.xyz/tags/diy/"/>
    
    <category term="arduino" scheme="https://ljweb.xyz/tags/arduino/"/>
    
    <category term="C语言" scheme="https://ljweb.xyz/tags/C%E8%AF%AD%E8%A8%80/"/>
    
  </entry>
  
  <entry>
    <title>OpenMv+arduino_uno实现循迹</title>
    <link href="https://ljweb.xyz/2021/11/21/OpenMv-arduino-uno%E5%AE%9E%E7%8E%B0%E5%BE%AA%E8%BF%B9/"/>
    <id>https://ljweb.xyz/2021/11/21/OpenMv-arduino-uno%E5%AE%9E%E7%8E%B0%E5%BE%AA%E8%BF%B9/</id>
    <published>2021-11-21T08:36:55.000Z</published>
    <updated>2022-02-16T14:10:43.384Z</updated>
    
    <content type="html"><![CDATA[<h1 id="OpenMv："><a href="#OpenMv：" class="headerlink" title="OpenMv："></a>OpenMv：</h1><blockquote><p>参考：<a href="https://book.openmv.cc/project/follow-lines.html">巡线小车 · OpenMV中文入门教程</a></p></blockquote><h3 id="1-OpenMv-main-py"><a href="#1-OpenMv-main-py" class="headerlink" title="1.OpenMv(main.py)"></a>1.OpenMv(main.py)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">功能描述</span></span><br><span class="line"><span class="string">    完整功能包括：</span></span><br><span class="line"><span class="string">    * 直线巡线</span></span><br><span class="line"><span class="string">    * 直角转弯判定　(左转or右转)</span></span><br><span class="line"><span class="string">    * T字形路口判定</span></span><br><span class="line"><span class="string">    * 十字形路口判定</span></span><br><span class="line"><span class="string">    其中Ｔ字形跟十字形可以用作四轴悬停的参考点。</span></span><br><span class="line"><span class="string">原理介绍</span></span><br><span class="line"><span class="string">    算法的主要核心在于，讲整个画面分割出来5个ROI区域</span></span><br><span class="line"><span class="string">    * 上方横向采样</span></span><br><span class="line"><span class="string">    * 中间横向采样</span></span><br><span class="line"><span class="string">    * 下方横向采样</span></span><br><span class="line"><span class="string">    * 左侧垂直采样</span></span><br><span class="line"><span class="string">    * 右侧垂直采样</span></span><br><span class="line"><span class="string">    通过判断5个图片的组合关系给出路口类型的判断</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">import</span> sensor</span><br><span class="line"><span class="keyword">import</span> image</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> pyb</span><br><span class="line"><span class="keyword">from</span> pyb <span class="keyword">import</span> Pin, Timer, UART,LED</span><br><span class="line"><span class="keyword">from</span> GeometryFeature <span class="keyword">import</span> GeometryFeature</span><br><span class="line"></span><br><span class="line">LED(<span class="number">4</span>).on()</span><br><span class="line">is_debug = <span class="literal">True</span></span><br><span class="line"><span class="comment">#--------------感光芯片配置  START -------------------</span></span><br><span class="line"></span><br><span class="line">DISTORTION_FACTOR = <span class="number">1.5</span> <span class="comment"># 设定畸变系数</span></span><br><span class="line">IMG_WIDTH  = <span class="number">64</span></span><br><span class="line">IMG_HEIGHT = <span class="number">64</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init_sensor</span>():</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    初始化感光芯片</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    sensor.reset()</span><br><span class="line">    sensor.set_pixformat(sensor.GRAYSCALE)</span><br><span class="line">    sensor.set_framesize(sensor.B64X64)                  <span class="comment"># 分辨率为B64X64</span></span><br><span class="line">    sensor.skip_frames(time=<span class="number">2000</span>)</span><br><span class="line">    sensor.set_auto_gain(<span class="literal">False</span>)                         <span class="comment"># 颜色追踪关闭自动增益</span></span><br><span class="line">    sensor.set_auto_whitebal(<span class="literal">False</span>)                     <span class="comment"># 颜色追踪关闭白平衡</span></span><br><span class="line"></span><br><span class="line">init_sensor()</span><br><span class="line"><span class="comment">#--------------感光芯片配置  END -------------------</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ternleft</span>():</span></span><br><span class="line">    uart.write(<span class="string">&#x27;G&#x27;</span>)</span><br><span class="line">    time.sleep_ms(<span class="number">650</span>)</span><br><span class="line">    uart.write(<span class="string">&#x27;L&#x27;</span>)</span><br><span class="line">    time.sleep_ms(<span class="number">600</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ternright</span>():</span></span><br><span class="line">    uart.write(<span class="string">&#x27;G&#x27;</span>)</span><br><span class="line">    time.sleep_ms(<span class="number">650</span>)</span><br><span class="line">    uart.write(<span class="string">&#x27;R&#x27;</span>)</span><br><span class="line">    time.sleep_ms(<span class="number">590</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#--------------串口UART部分  START -------------------</span></span><br><span class="line">uart = pyb.UART(<span class="number">3</span>,<span class="number">115200</span>,timeout_char = <span class="number">1000</span>) <span class="comment">#串口初始化</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_symbol</span>(<span class="params">num</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    根据数值正负，返回数值对应的符号</span></span><br><span class="line"><span class="string">    正数：‘+’， 负数‘-’ 主要为了方便C语言解析待符号的数值。</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> num &gt;=<span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;+&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;-&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">data_format_wrapper</span>(<span class="params">yaw_angle, sum_x, sum_y, cx_mean, cx, cy, is_left_angle, is_t, last_y</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    根据通信协议封装数据</span></span><br><span class="line"><span class="string">    TODO 重新编写通信协议  与配套C解析代码</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    yaw_angle,sum_x, sum_y 没有用到</span></span><br><span class="line"><span class="string">    cx_mean: roi 1 2 3 对应的bolb中心的x坐标加权平均， 如果没有就补32  都没有就赋值为原来的值</span></span><br><span class="line"><span class="string">    cx : roi 1 3 blob 中心坐标的加权平均， 如果一方丢失， 就赋值为另外一个  都没有就赋值为原来的值</span></span><br><span class="line"><span class="string">    cy : roi 4 5 blob 中心坐标的加权平均，如果一方丢失， 就赋值为另外一个， 都没有就赋值为原来的值</span></span><br><span class="line"><span class="string">    is_left_angle :代表是否有直角，！！！信息丢失</span></span><br><span class="line"><span class="string">             其实，可以用一个字符来表示，是左转还是右转 T(T字形)  L(Left) R(Right)</span></span><br><span class="line"><span class="string">    last_x, last_y 是两个直线的交叉点的坐标  改写为 intersect_x，intersect_y</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    args = [</span></span><br><span class="line"><span class="string">        get_symbol(yaw_angle), # 偏航角符号</span></span><br><span class="line"><span class="string">        abs(int(yaw_angle)), # 偏航角</span></span><br><span class="line"><span class="string">        get_symbol(sum_x), # 光流数据sux_x的符号</span></span><br><span class="line"><span class="string">        abs(int(sum_x)), # 光流数据sum_x</span></span><br><span class="line"><span class="string">        get_symbol(sum_y), # 光流数据sum_y的符号</span></span><br><span class="line"><span class="string">        abs(int(sum_y)), # 光流数据 sum_y</span></span><br><span class="line"><span class="string">        int(cx_mean), # x的中心，三个取样区域色块中心x坐标的平均值</span></span><br><span class="line"><span class="string">        int(cx),</span></span><br><span class="line"><span class="string">        int(cy),</span></span><br><span class="line"><span class="string">        int(is_left_angle),</span></span><br><span class="line"><span class="string">        int(last_x),</span></span><br><span class="line"><span class="string">        int(last_y)</span></span><br><span class="line"><span class="string">    ]</span></span><br><span class="line"><span class="string">    # 将数值列表按照通信协议，转换为待发送的字符</span></span><br><span class="line"><span class="string">    info = &#x27;s%c%.2d%c%.2d%c%.2d%.2d%.2d%.2d%.2d%.2d%.2d#&#x27;%tuple(args)</span></span><br><span class="line"><span class="string">    global is_debug</span></span><br><span class="line"><span class="string">    if is_debug:</span></span><br><span class="line"><span class="string">        print(&#x27;s%c%.2d%c%.2d%c%.2d | cx_mean=%.2d cx=%.2d cy=%.2d Turn Left: %.2d | %.2d%.2d#&#x27;%tuple(args))</span></span><br><span class="line"><span class="string">            &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> cx_mean &gt;= <span class="number">22</span> <span class="keyword">and</span> cx_mean &lt;=<span class="number">40</span> :</span><br><span class="line">        info=<span class="string">&#x27;G&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> cx_mean&lt;<span class="number">22</span>  :</span><br><span class="line">        info=<span class="string">&#x27;L&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> cx_mean&gt;<span class="number">40</span>  :</span><br><span class="line">        info=<span class="string">&#x27;R&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> is_t        :</span><br><span class="line">        info=<span class="string">&#x27;S&#x27;</span></span><br><span class="line">        ternleft()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> info</span><br><span class="line"><span class="comment">#--------------串口UART部分 END -------------------</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#--------------定时器部分 START -------------------</span></span><br><span class="line"></span><br><span class="line">is_need_send_data = <span class="literal">False</span> <span class="comment"># 是否需要发送数据的信号标志</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">uart_time_trigger</span>(<span class="params">timer</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    串口发送数据的定时器，定时器的回调函数</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">global</span> is_need_send_data</span><br><span class="line">    is_need_send_data = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化定时器 频率为20HZ 每秒执行20次</span></span><br><span class="line">tim = Timer(<span class="number">4</span>, freq=<span class="number">20</span>)</span><br><span class="line"><span class="comment"># 设定定时器的回调函数</span></span><br><span class="line">tim.callback(uart_time_trigger)</span><br><span class="line"><span class="comment">#--------------定时器部分 END -------------------</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#--------------直线与直角检测部分 START -------------------</span></span><br><span class="line"></span><br><span class="line">INTERSERCT_ANGLE_THRESHOLD = (<span class="number">45</span>,<span class="number">90</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 直线灰度图颜色阈值</span></span><br><span class="line">LINE_COLOR_THRESHOLD = [(<span class="number">20</span>, <span class="number">80</span>)]</span><br><span class="line"><span class="comment"># 如果直线是白色的，阈值修改为：</span></span><br><span class="line"><span class="comment"># LINE_COLOR_THRESHOLD = [(128, 255)]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 取样窗口</span></span><br><span class="line">ROIS = &#123;</span><br><span class="line">    <span class="string">&#x27;down&#x27;</span>: (<span class="number">0</span>, <span class="number">55</span>, <span class="number">64</span>, <span class="number">8</span>), <span class="comment"># 横向取样-下方 1</span></span><br><span class="line">    <span class="string">&#x27;middle&#x27;</span>: (<span class="number">0</span>, <span class="number">28</span>, <span class="number">64</span>, <span class="number">8</span>), <span class="comment"># 横向取样-中间 2</span></span><br><span class="line">    <span class="string">&#x27;up&#x27;</span>: (<span class="number">0</span>, <span class="number">0</span>, <span class="number">64</span>, <span class="number">8</span>), <span class="comment"># 横向取样-上方 3</span></span><br><span class="line">    <span class="string">&#x27;left&#x27;</span>: (<span class="number">0</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">64</span>), <span class="comment"># 纵向取样-左侧 4</span></span><br><span class="line">    <span class="string">&#x27;right&#x27;</span>: (<span class="number">56</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">64</span>) <span class="comment"># 纵向取样-右侧 5</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_blobs_in_rois</span>(<span class="params">img</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    在ROIS中寻找色块，获取ROI中色块的中心区域与是否有色块的信息</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">global</span> ROIS</span><br><span class="line">    <span class="keyword">global</span> is_debug</span><br><span class="line"></span><br><span class="line">    roi_blobs_result = &#123;&#125;  <span class="comment"># 在各个ROI中寻找色块的结果记录</span></span><br><span class="line">    <span class="keyword">for</span> roi_direct <span class="keyword">in</span> ROIS.keys():</span><br><span class="line">        roi_blobs_result[roi_direct] = &#123;</span><br><span class="line">            <span class="string">&#x27;cx&#x27;</span>: -<span class="number">1</span>,</span><br><span class="line">            <span class="string">&#x27;cy&#x27;</span>: -<span class="number">1</span>,</span><br><span class="line">            <span class="string">&#x27;blob_flag&#x27;</span>: <span class="literal">False</span></span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">for</span> roi_direct, roi <span class="keyword">in</span> ROIS.items():</span><br><span class="line">        blobs=img.find_blobs(LINE_COLOR_THRESHOLD, roi=roi, merge=<span class="literal">True</span>, pixels_area=<span class="number">10</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(blobs) == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        largest_blob = <span class="built_in">max</span>(blobs, key=<span class="keyword">lambda</span> b: b.pixels())</span><br><span class="line">        x,y,width,height = largest_blob[:<span class="number">4</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span>(width &gt;=<span class="number">5</span> <span class="keyword">and</span> width &lt;= <span class="number">15</span> <span class="keyword">and</span> height &gt;= <span class="number">5</span> <span class="keyword">and</span> height &lt;= <span class="number">15</span>):</span><br><span class="line">            <span class="comment"># 根据色块的宽度进行过滤</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        roi_blobs_result[roi_direct][<span class="string">&#x27;cx&#x27;</span>] = largest_blob.cx()</span><br><span class="line">        roi_blobs_result[roi_direct][<span class="string">&#x27;cy&#x27;</span>] = largest_blob.cy()</span><br><span class="line">        roi_blobs_result[roi_direct][<span class="string">&#x27;blob_flag&#x27;</span>] = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> is_debug:</span><br><span class="line">            img.draw_rectangle((x,y,width, height), color=(<span class="number">255</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> roi_blobs_result</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">visualize_result</span>(<span class="params">canvas, cx_mean, cx, cy, is_turn_left, is_turn_right, is_t, is_cross</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    可视化结果</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span>(is_turn_left <span class="keyword">or</span> is_turn_right <span class="keyword">or</span> is_t <span class="keyword">or</span> is_cross):</span><br><span class="line">        mid_x = <span class="built_in">int</span>(canvas.width()/<span class="number">2</span>)</span><br><span class="line">        mid_y = <span class="built_in">int</span>(canvas.height()/<span class="number">2</span>)</span><br><span class="line">        <span class="comment"># 绘制x的均值点</span></span><br><span class="line">        canvas.draw_circle(<span class="built_in">int</span>(cx_mean), mid_y, <span class="number">5</span>, color=(<span class="number">255</span>))</span><br><span class="line">        <span class="comment"># 绘制屏幕中心点</span></span><br><span class="line">        canvas.draw_circle(mid_x, mid_y, <span class="number">8</span>, color=(<span class="number">0</span>))</span><br><span class="line">        canvas.draw_line((mid_x, mid_y, <span class="built_in">int</span>(cx_mean), mid_y), color=(<span class="number">255</span>))</span><br><span class="line"></span><br><span class="line">    turn_type = <span class="string">&#x27;N&#x27;</span> <span class="comment"># 啥转角也不是</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> is_t <span class="keyword">or</span> is_cross:</span><br><span class="line">        <span class="comment"># 十字形或者T形</span></span><br><span class="line">        canvas.draw_cross(<span class="built_in">int</span>(cx), <span class="built_in">int</span>(cy), size=<span class="number">10</span>, color=(<span class="number">255</span>))</span><br><span class="line">        canvas.draw_circle(<span class="built_in">int</span>(cx), <span class="built_in">int</span>(cy), <span class="number">5</span>, color=(<span class="number">255</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> is_t:</span><br><span class="line">        turn_type = <span class="string">&#x27;T&#x27;</span> <span class="comment"># T字形状</span></span><br><span class="line">    <span class="keyword">elif</span> is_cross:</span><br><span class="line">        turn_type = <span class="string">&#x27;C&#x27;</span> <span class="comment"># 十字形</span></span><br><span class="line">    <span class="keyword">elif</span> is_turn_left:</span><br><span class="line">        turn_type = <span class="string">&#x27;L&#x27;</span> <span class="comment"># 左转</span></span><br><span class="line">    <span class="keyword">elif</span> is_turn_right:</span><br><span class="line">        turn_type = <span class="string">&#x27;R&#x27;</span> <span class="comment"># 右转</span></span><br><span class="line"></span><br><span class="line">    canvas.draw_string(<span class="number">0</span>, <span class="number">0</span>, turn_type, color=(<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#--------------直线与直角检测部分 END -------------------</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#---------------------MAIN-----------------------</span></span><br><span class="line">last_cx = <span class="number">0</span></span><br><span class="line">last_cy = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> is_need_send_data:</span><br><span class="line">        <span class="comment"># 不需要发送数据</span></span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    is_need_send_data = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 拍摄图片</span></span><br><span class="line">    img = sensor.snapshot()</span><br><span class="line">    <span class="comment"># 去除图像畸变</span></span><br><span class="line">    img.lens_corr(DISTORTION_FACTOR)</span><br><span class="line">    <span class="comment"># 创建画布</span></span><br><span class="line">    <span class="comment"># canvas = img.copy()</span></span><br><span class="line">    <span class="comment"># 为了IDE显示方便，直接在代码结尾 用IMG绘制</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 注意：林林的代码里 计算直线之间的交点的代码没有用到</span></span><br><span class="line">    lines = img.find_lines(threshold=<span class="number">1000</span>, theta_margin = <span class="number">50</span>, rho_margin = <span class="number">50</span>)</span><br><span class="line">    <span class="comment"># 寻找相交的点 要求满足角度阈值</span></span><br><span class="line">    intersect_pt = GeometryFeature.find_interserct_lines(lines, angle_threshold=(<span class="number">45</span>,<span class="number">90</span>), window_size=(IMG_WIDTH, IMG_HEIGHT))</span><br><span class="line">    <span class="keyword">if</span> intersect_pt <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="comment"># 直线与直线之间的夹角不满足阈值范围</span></span><br><span class="line">        intersect_x = <span class="number">0</span></span><br><span class="line">        intersect_y = <span class="number">0</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        intersect_x, intersect_y = intersect_pt</span><br><span class="line"></span><br><span class="line">    reslut = find_blobs_in_rois(img)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 判断是否需要左转与右转</span></span><br><span class="line">    is_turn_left = <span class="literal">False</span></span><br><span class="line">    is_turn_right = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">not</span> reslut[<span class="string">&#x27;up&#x27;</span>][<span class="string">&#x27;blob_flag&#x27;</span>] ) <span class="keyword">and</span> reslut[<span class="string">&#x27;down&#x27;</span>][<span class="string">&#x27;blob_flag&#x27;</span>]:</span><br><span class="line">        <span class="keyword">if</span> reslut[<span class="string">&#x27;left&#x27;</span>][<span class="string">&#x27;blob_flag&#x27;</span>]:</span><br><span class="line">            is_turn_left = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">if</span> reslut[<span class="string">&#x27;right&#x27;</span>][<span class="string">&#x27;blob_flag&#x27;</span>]:</span><br><span class="line">            is_turn_right = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 判断是否为T形的轨道</span></span><br><span class="line">    is_t = <span class="literal">False</span></span><br><span class="line">    <span class="comment"># 判断是否十字形轨道</span></span><br><span class="line">    is_cross = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    cnt = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> roi_direct <span class="keyword">in</span> [<span class="string">&#x27;up&#x27;</span>, <span class="string">&#x27;down&#x27;</span>, <span class="string">&#x27;left&#x27;</span>, <span class="string">&#x27;right&#x27;</span>]:</span><br><span class="line">        <span class="keyword">if</span> reslut[roi_direct][<span class="string">&#x27;blob_flag&#x27;</span>]:</span><br><span class="line">            cnt += <span class="number">1</span></span><br><span class="line">    is_t = cnt == <span class="number">3</span></span><br><span class="line">    is_cross = cnt == <span class="number">4</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># cx_mean 用于确定视角中的轨道中心</span></span><br><span class="line">    <span class="comment"># 用于表示左右偏移量</span></span><br><span class="line">    cx_mean = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> roi_direct <span class="keyword">in</span> [<span class="string">&#x27;up&#x27;</span>, <span class="string">&#x27;down&#x27;</span>, <span class="string">&#x27;middle&#x27;</span>]:</span><br><span class="line">        <span class="keyword">if</span> reslut[roi_direct][<span class="string">&#x27;blob_flag&#x27;</span>]:</span><br><span class="line">            cx_mean += reslut[roi_direct][<span class="string">&#x27;cx&#x27;</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            cx_mean += IMG_WIDTH / <span class="number">2</span></span><br><span class="line">    cx_mean /= <span class="number">3</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># cx, cy 只有在T形区域检测出来的时候才有用，</span></span><br><span class="line">    <span class="comment"># 用于确定轨道中圆形的大致区域， 用于定点， 是计算圆心的一种近似方法</span></span><br><span class="line"></span><br><span class="line">    cx = <span class="number">0</span></span><br><span class="line">    cy = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> is_cross <span class="keyword">or</span> is_t:</span><br><span class="line">        <span class="comment"># 只在出现十字形或者T字形才计算圆心坐标</span></span><br><span class="line">        cnt = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> roi_direct <span class="keyword">in</span> [<span class="string">&#x27;up&#x27;</span>, <span class="string">&#x27;down&#x27;</span>]:</span><br><span class="line">            <span class="keyword">if</span> reslut[roi_direct][<span class="string">&#x27;blob_flag&#x27;</span>]:</span><br><span class="line">                cnt += <span class="number">1</span></span><br><span class="line">                cx += reslut[roi_direct][<span class="string">&#x27;cx&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> cnt == <span class="number">0</span>:</span><br><span class="line">            cx = last_cx</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            cx /= cnt</span><br><span class="line"></span><br><span class="line">        cnt = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> roi_direct <span class="keyword">in</span> [<span class="string">&#x27;left&#x27;</span>, <span class="string">&#x27;right&#x27;</span>]:</span><br><span class="line">            <span class="keyword">if</span> reslut[roi_direct][<span class="string">&#x27;blob_flag&#x27;</span>]:</span><br><span class="line">                cnt += <span class="number">1</span></span><br><span class="line">                cy += reslut[roi_direct][<span class="string">&#x27;cy&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> cnt == <span class="number">0</span>:</span><br><span class="line">            cy = last_cy</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            cy /= cnt</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 为了兼容之前的程序，按照之前的数据通信协议发送</span></span><br><span class="line">    <span class="comment"># 林林的代码里没有用到的变量均设为 0， 且巡线演示历程中，只用到了左转</span></span><br><span class="line">    <span class="comment"># 发送信息格式，可以自行改造, 例如 添加 is_turn_left</span></span><br><span class="line">    info = data_format_wrapper(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, cx_mean, cx, cy, is_turn_left, is_t, <span class="number">0</span>)</span><br><span class="line">    uart.write(info)</span><br><span class="line">    <span class="built_in">print</span>(info)</span><br><span class="line"></span><br><span class="line">    last_cx = cx</span><br><span class="line">    last_cy = cy</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> is_debug:</span><br><span class="line">        visualize_result(img, cx_mean, cx, cy, is_turn_left, is_turn_right, is_t, is_cross)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2-car-py"><a href="#2-car-py" class="headerlink" title="2.car.py"></a>2.car.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyb <span class="keyword">import</span> Pin, Timer</span><br><span class="line">inverse_left=<span class="literal">False</span>  <span class="comment">#change it to True to inverse left wheel</span></span><br><span class="line">inverse_right=<span class="literal">False</span> <span class="comment">#change it to True to inverse right wheel</span></span><br><span class="line"></span><br><span class="line">ain1 =  Pin(<span class="string">&#x27;P0&#x27;</span>, Pin.OUT_PP)</span><br><span class="line">ain2 =  Pin(<span class="string">&#x27;P1&#x27;</span>, Pin.OUT_PP)</span><br><span class="line">bin1 =  Pin(<span class="string">&#x27;P2&#x27;</span>, Pin.OUT_PP)</span><br><span class="line">bin2 =  Pin(<span class="string">&#x27;P3&#x27;</span>, Pin.OUT_PP)</span><br><span class="line">ain1.low()</span><br><span class="line">ain2.low()</span><br><span class="line">bin1.low()</span><br><span class="line">bin2.low()</span><br><span class="line"></span><br><span class="line">pwma = Pin(<span class="string">&#x27;P7&#x27;</span>)</span><br><span class="line">pwmb = Pin(<span class="string">&#x27;P8&#x27;</span>)</span><br><span class="line">tim = Timer(<span class="number">4</span>, freq=<span class="number">1000</span>)</span><br><span class="line">ch1 = tim.channel(<span class="number">1</span>, Timer.PWM, pin=pwma)</span><br><span class="line">ch2 = tim.channel(<span class="number">2</span>, Timer.PWM, pin=pwmb)</span><br><span class="line">ch1.pulse_width_percent(<span class="number">0</span>)</span><br><span class="line">ch2.pulse_width_percent(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">left_speed, right_speed</span>):</span></span><br><span class="line">    <span class="keyword">if</span> inverse_left==<span class="literal">True</span>:</span><br><span class="line">        left_speed=(-left_speed)</span><br><span class="line">    <span class="keyword">if</span> inverse_right==<span class="literal">True</span>:</span><br><span class="line">        right_speed=(-right_speed)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> left_speed &lt; <span class="number">0</span>:</span><br><span class="line">        ain1.low()</span><br><span class="line">        ain2.high()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        ain1.high()</span><br><span class="line">        ain2.low()</span><br><span class="line">    ch1.pulse_width_percent(<span class="built_in">int</span>(<span class="built_in">abs</span>(left_speed)))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> right_speed &lt; <span class="number">0</span>:</span><br><span class="line">        bin1.low()</span><br><span class="line">        bin2.high()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        bin1.high()</span><br><span class="line">        bin2.low()</span><br><span class="line">    ch2.pulse_width_percent(<span class="built_in">int</span>(<span class="built_in">abs</span>(right_speed)))</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2-pid-py"><a href="#2-pid-py" class="headerlink" title="2.pid.py"></a>2.pid.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyb <span class="keyword">import</span> millis</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> pi, isnan</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PID</span>:</span></span><br><span class="line">    _kp = _ki = _kd = _integrator = _imax = <span class="number">0</span></span><br><span class="line">    _last_error = _last_derivative = _last_t = <span class="number">0</span></span><br><span class="line">    _RC = <span class="number">1</span>/(<span class="number">2</span> * pi * <span class="number">20</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, p=<span class="number">0</span>, i=<span class="number">0</span>, d=<span class="number">0</span>, imax=<span class="number">0</span></span>):</span></span><br><span class="line">        self._kp = <span class="built_in">float</span>(p)</span><br><span class="line">        self._ki = <span class="built_in">float</span>(i)</span><br><span class="line">        self._kd = <span class="built_in">float</span>(d)</span><br><span class="line">        self._imax = <span class="built_in">abs</span>(imax)</span><br><span class="line">        self._last_derivative = <span class="built_in">float</span>(<span class="string">&#x27;nan&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_pid</span>(<span class="params">self, error, scaler</span>):</span></span><br><span class="line">        tnow = millis()</span><br><span class="line">        dt = tnow - self._last_t</span><br><span class="line">        output = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> self._last_t == <span class="number">0</span> <span class="keyword">or</span> dt &gt; <span class="number">1000</span>:</span><br><span class="line">            dt = <span class="number">0</span></span><br><span class="line">            self.reset_I()</span><br><span class="line">        self._last_t = tnow</span><br><span class="line">        delta_time = <span class="built_in">float</span>(dt) / <span class="built_in">float</span>(<span class="number">1000</span>)</span><br><span class="line">        output += error * self._kp</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">abs</span>(self._kd) &gt; <span class="number">0</span> <span class="keyword">and</span> dt &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> isnan(self._last_derivative):</span><br><span class="line">                derivative = <span class="number">0</span></span><br><span class="line">                self._last_derivative = <span class="number">0</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                derivative = (error - self._last_error) / delta_time</span><br><span class="line">            derivative = self._last_derivative + \</span><br><span class="line">                                     ((delta_time / (self._RC + delta_time)) * \</span><br><span class="line">                                        (derivative - self._last_derivative))</span><br><span class="line">            self._last_error = error</span><br><span class="line">            self._last_derivative = derivative</span><br><span class="line">            output += self._kd * derivative</span><br><span class="line">        output *= scaler</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">abs</span>(self._ki) &gt; <span class="number">0</span> <span class="keyword">and</span> dt &gt; <span class="number">0</span>:</span><br><span class="line">            self._integrator += (error * self._ki) * scaler * delta_time</span><br><span class="line">            <span class="keyword">if</span> self._integrator &lt; -self._imax: self._integrator = -self._imax</span><br><span class="line">            <span class="keyword">elif</span> self._integrator &gt; self._imax: self._integrator = self._imax</span><br><span class="line">            output += self._integrator</span><br><span class="line">        <span class="keyword">return</span> output</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reset_I</span>(<span class="params">self</span>):</span></span><br><span class="line">        self._integrator = <span class="number">0</span></span><br><span class="line">        self._last_derivative = <span class="built_in">float</span>(<span class="string">&#x27;nan&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="arduino"><a href="#arduino" class="headerlink" title="arduino:"></a>arduino:</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;SPI.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Wire.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Adafruit_GFX.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Adafruit_SSD1306.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> OLED_RESET 4</span></span><br><span class="line"><span class="function">Adafruit_SSD1306 <span class="title">display</span><span class="params">(OLED_RESET)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> (SSD1306_LCDHEIGHT != 64)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">error</span>(<span class="meta-string">&quot;Height incorrect, please fix Adafruit_SSD1306.h!&quot;</span>);</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LF1 10</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LF2 11</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> RI1 6</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> RI2 5</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> HW1 13</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> HW2 12</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> RED A0</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> GREEN A1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> TZOUTPUT 8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> leftpwm = <span class="number">255</span>;</span><br><span class="line"><span class="keyword">int</span> rightpwm = <span class="number">255</span>;</span><br><span class="line"><span class="keyword">int</span> quyao = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> com;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> continue_time = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">go</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  analogWrite(LF1, leftpwm);</span><br><span class="line">  analogWrite(LF2, <span class="number">0</span>);</span><br><span class="line">  analogWrite(RI1, rightpwm);</span><br><span class="line">  analogWrite(RI2, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">right</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  analogWrite(LF1, <span class="number">180</span>);</span><br><span class="line">  analogWrite(LF2, <span class="number">0</span>);</span><br><span class="line">  analogWrite(RI1, <span class="number">0</span>);</span><br><span class="line">  analogWrite(RI2, <span class="number">180</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">left</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  analogWrite(LF1, <span class="number">0</span>);</span><br><span class="line">  analogWrite(LF2, <span class="number">180</span>);</span><br><span class="line">  analogWrite(RI1, <span class="number">180</span>);</span><br><span class="line">  analogWrite(RI2, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">back</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  analogWrite(LF1, <span class="number">0</span>);</span><br><span class="line">  analogWrite(LF2, leftpwm);</span><br><span class="line">  analogWrite(RI1, <span class="number">0</span>);</span><br><span class="line">  analogWrite(RI2, rightpwm);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">carstop</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  analogWrite(LF1, <span class="number">0</span>);</span><br><span class="line">  analogWrite(LF2, <span class="number">0</span>);</span><br><span class="line">  analogWrite(RI1, <span class="number">0</span>);</span><br><span class="line">  analogWrite(RI2, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">doudong</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  analogWrite(LF1, <span class="number">150</span>);</span><br><span class="line">  analogWrite(LF2, <span class="number">0</span>);</span><br><span class="line">  analogWrite(RI1, <span class="number">0</span>);</span><br><span class="line">  analogWrite(RI2, <span class="number">150</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">red</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  digitalWrite(RED,LOW);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">green</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  digitalWrite(GREEN,LOW);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">notlight</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  digitalWrite(RED,HIGH);</span><br><span class="line">  digitalWrite(GREEN,HIGH);  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">palldown</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  analogWrite(LF1, <span class="number">80</span>);</span><br><span class="line">  analogWrite(LF2, <span class="number">0</span>);</span><br><span class="line">  analogWrite(RI1, <span class="number">85</span>);</span><br><span class="line">  analogWrite(RI2, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">// put your setup code here, to run once:</span></span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">  display.begin(SSD1306_SWITCHCAPVCC, <span class="number">0x3C</span>);</span><br><span class="line">  display.clearDisplay();</span><br><span class="line">  display.display();</span><br><span class="line">  <span class="comment">//delay(2000);</span></span><br><span class="line">  pinMode(LF1, OUTPUT);</span><br><span class="line">  pinMode(LF2, OUTPUT);</span><br><span class="line">  pinMode(RI1, OUTPUT);</span><br><span class="line">  pinMode(RI2, OUTPUT);</span><br><span class="line">  pinMode(HW1, INPUT);</span><br><span class="line">  pinMode(HW2, INPUT);</span><br><span class="line">  </span><br><span class="line">  pinMode(RED, OUTPUT);</span><br><span class="line">  pinMode(GREEN, OUTPUT);</span><br><span class="line">  pinMode(TZOUTPUT, OUTPUT);</span><br><span class="line">  digitalWrite(TZOUTPUT,LOW);</span><br><span class="line">  digitalWrite(RED,HIGH);</span><br><span class="line">  digitalWrite(GREEN,HIGH);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">oledisplay</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="comment">// text display tests</span></span><br><span class="line">  display.clearDisplay();</span><br><span class="line">  display.setTextSize(<span class="number">1</span>);</span><br><span class="line">  display.setTextColor(WHITE);</span><br><span class="line">  display.setCursor(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  display.print(<span class="string">&quot;leftpwm:&quot;</span>);</span><br><span class="line">  display.println(leftpwm);</span><br><span class="line">  display.print(<span class="string">&quot;rightpwm:&quot;</span>);</span><br><span class="line">  display.println(rightpwm);</span><br><span class="line">  display.setTextSize(<span class="number">2</span>);</span><br><span class="line">  display.print(<span class="string">&quot;com:&quot;</span>);</span><br><span class="line">  display.println(com);</span><br><span class="line">  display.display();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cktx</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//指令接收部分</span></span><br><span class="line">  <span class="comment">//蓝牙遥控部分</span></span><br><span class="line">  <span class="comment">// 读取串口发送的信息:</span></span><br><span class="line">  <span class="keyword">if</span> (Serial.available() &gt; <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">char</span> inChar;</span><br><span class="line">    inChar = Serial.read();</span><br><span class="line">    <span class="keyword">if</span> (com != inChar)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">//  bt_rec_flag = 1;</span></span><br><span class="line">      com = inChar;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">          <span class="comment">//  else    // 调试用</span></span><br><span class="line">            <span class="comment">//com = &#x27;S&#x27;;</span></span><br><span class="line">    </span><br><span class="line">   </span><br><span class="line">      </span><br><span class="line">      <span class="keyword">switch</span> (com)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;G&#x27;</span>:    go(); Serial.println(<span class="string">&quot;直行&quot;</span>); <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;L&#x27;</span>:  left(); Serial.println(<span class="string">&quot;左转&quot;</span>); <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;R&#x27;</span>:  right(); Serial.println(<span class="string">&quot;右转&quot;</span>); <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;B&#x27;</span>:  back(); Serial.println(<span class="string">&quot;后退&quot;</span>); <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;S&#x27;</span>:  carstop(); Serial.println(<span class="string">&quot;停车&quot;</span>); <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;1&#x27;</span>:  red(); Serial.println(<span class="string">&quot;RED&quot;</span>);<span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;2&#x27;</span>:  green();Serial.println(<span class="string">&quot;GREEN&quot;</span>);<span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;3&#x27;</span>:  notlight();Serial.println(<span class="string">&quot;熄灭&quot;</span>);<span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;H&#x27;</span>:  palldown();Serial.println(<span class="string">&quot;速度减半&quot;</span>);<span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span> : <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">tinzhi</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(digitalRead(HW1)==HIGH||digitalRead(HW2)==HIGH)</span><br><span class="line">  &#123;</span><br><span class="line">    digitalWrite(TZOUTPUT,HIGH);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  cktx();</span><br><span class="line">  tinzhi();</span><br><span class="line"> <span class="comment">// Serial.println(quyao);</span></span><br><span class="line"> <span class="comment">// doudong();</span></span><br><span class="line">  <span class="comment">//oledisplay();</span></span><br><span class="line">  <span class="comment">//delay(10);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;OpenMv：&quot;&gt;&lt;a href=&quot;#OpenMv：&quot; class=&quot;headerlink&quot; title=&quot;OpenMv：&quot;&gt;&lt;/a&gt;OpenMv：&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;参考：&lt;a href=&quot;https://book.openmv.cc/pr</summary>
      
    
    
    
    <category term="智能车" scheme="https://ljweb.xyz/categories/%E6%99%BA%E8%83%BD%E8%BD%A6/"/>
    
    
    <category term="OpenMv" scheme="https://ljweb.xyz/tags/OpenMv/"/>
    
    <category term="diy" scheme="https://ljweb.xyz/tags/diy/"/>
    
    <category term="arduino" scheme="https://ljweb.xyz/tags/arduino/"/>
    
  </entry>
  
  <entry>
    <title>typora使用教程</title>
    <link href="https://ljweb.xyz/2021/11/20/typora%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/"/>
    <id>https://ljweb.xyz/2021/11/20/typora%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/</id>
    <published>2021-11-20T17:33:07.000Z</published>
    <updated>2022-02-16T14:10:43.384Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>参考：<a href="https://www.cnblogs.com/hider/p/11614688.html">Typora入门：全网最全教程 - Hider1214 </a></p></blockquote><h1 id="1-Typora快捷键整合"><a href="#1-Typora快捷键整合" class="headerlink" title="1.Typora快捷键整合"></a>1.Typora快捷键整合</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Ctrl+1  一阶标题    Ctrl+B  字体加粗</span><br><span class="line">Ctrl+2  二阶标题    Ctrl+I  字体倾斜</span><br><span class="line">Ctrl+3  三阶标题    Ctrl+U  下划线</span><br><span class="line">Ctrl+4  四阶标题    Ctrl+Home   返回Typora顶部</span><br><span class="line">Ctrl+5  五阶标题    Ctrl+End    返回Typora底部</span><br><span class="line">Ctrl+6  六阶标题    Ctrl+T  创建表格</span><br><span class="line">Ctrl+L  选中某句话   Ctrl+K  创建超链接</span><br><span class="line">Ctrl+D  选中某个单词  Ctrl+F  搜索</span><br><span class="line">Ctrl+E  选中相同格式的文字   Ctrl+H  搜索并替换</span><br><span class="line">Alt+Shift+5     删除线 </span><br><span class="line">Ctrl+Shift+I    插入图片</span><br><span class="line">Ctrl+Shift+M    公式块 </span><br><span class="line">Ctrl+Shift+Q    引用</span><br><span class="line">Ctrl + B        加粗</span><br><span class="line">注：一些实体符号需要在实体符号之前加”\”才能够显示</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;参考：&lt;a href=&quot;https://www.cnblogs.com/hider/p/11614688.html&quot;&gt;Typora入门：全网最全教程 - Hider1214 &lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;1-Typo</summary>
      
    
    
    
    <category term="教程" scheme="https://ljweb.xyz/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="教程" scheme="https://ljweb.xyz/tags/%E6%95%99%E7%A8%8B/"/>
    
    <category term="typora" scheme="https://ljweb.xyz/tags/typora/"/>
    
  </entry>
  
  <entry>
    <title>51循迹小车</title>
    <link href="https://ljweb.xyz/2021/11/20/51%E5%BE%AA%E8%BF%B9%E5%B0%8F%E8%BD%A6/"/>
    <id>https://ljweb.xyz/2021/11/20/51%E5%BE%AA%E8%BF%B9%E5%B0%8F%E8%BD%A6/</id>
    <published>2021-11-20T16:54:55.000Z</published>
    <updated>2022-02-16T14:10:43.384Z</updated>
    
    <content type="html"><![CDATA[<h1 id="参考代码"><a href="#参考代码" class="headerlink" title="参考代码"></a>参考代码</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;reg52.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">sbit LED1=P2^<span class="number">7</span>;<span class="comment">//大灯 0亮</span></span><br><span class="line">sbit LED2=P2^<span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">sbit LF1=P0^<span class="number">2</span>;<span class="comment">//左前电机</span></span><br><span class="line">sbit LF2=P0^<span class="number">3</span>;</span><br><span class="line">sbit RF1=P0^<span class="number">4</span>;<span class="comment">//右前电机</span></span><br><span class="line">sbit RF2=P0^<span class="number">5</span>;</span><br><span class="line">sbit LB2=P0^<span class="number">0</span>;<span class="comment">//左后电机</span></span><br><span class="line">sbit LB1=P0^<span class="number">1</span>;</span><br><span class="line">sbit RB1=P0^<span class="number">6</span>;<span class="comment">//右后电机</span></span><br><span class="line">sbit RB2=P0^<span class="number">7</span>;</span><br><span class="line"></span><br><span class="line">sbit XJ1  = P2^<span class="number">4</span>;<span class="comment">//右边红外传感器的数据口</span></span><br><span class="line">sbit XJ2  = P2^<span class="number">5</span>;<span class="comment">//左边红外传感器的数据口</span></span><br><span class="line"></span><br><span class="line">sbit BZ1=P2^<span class="number">3</span>;<span class="comment">//左右避障传感器数据口</span></span><br><span class="line">sbit BZ2=P2^<span class="number">6</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> zkb1 = <span class="number">0</span>;<span class="comment">//定义了一下左边两个轮的占空比</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> zkb2 = <span class="number">0</span>;<span class="comment">//定义了一下右边两个轮的占空比</span></span><br><span class="line"><span class="keyword">int</span> t = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">delayms</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> ms)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> i=<span class="number">100</span>,j;</span><br><span class="line"><span class="keyword">for</span>(;ms;ms--)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">while</span>(--i)</span><br><span class="line">&#123;</span><br><span class="line">j=<span class="number">10</span>;</span><br><span class="line"><span class="keyword">while</span>(--j);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">PIT_Init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> EA    = <span class="number">1</span>;</span><br><span class="line">TMOD |= <span class="number">0x01</span>;</span><br><span class="line">TH0   = (<span class="number">65536</span> - <span class="number">200</span>) / <span class="number">256</span>;</span><br><span class="line">TL0   = (<span class="number">65536</span> - <span class="number">200</span>) % <span class="number">256</span>;</span><br><span class="line">ET0   = <span class="number">1</span>;</span><br><span class="line">TR0   = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">timer</span><span class="params">()</span>interrupt 1</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  TH0 = (<span class="number">65536</span><span class="number">-200</span>)/<span class="number">256</span>;</span><br><span class="line">TL0 = (<span class="number">65536</span><span class="number">-200</span>)%<span class="number">256</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(t&lt;zkb1)</span><br><span class="line">&#123;</span><br><span class="line">   LF1=<span class="number">0</span>;</span><br><span class="line">LF2=<span class="number">1</span>;</span><br><span class="line">LB1=<span class="number">0</span>;</span><br><span class="line">LB2=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">  LF1=<span class="number">0</span>;</span><br><span class="line">LF2=<span class="number">0</span>;</span><br><span class="line">LB1=<span class="number">0</span>;</span><br><span class="line">LB2=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(t&lt;zkb2)</span><br><span class="line">&#123;</span><br><span class="line">RF1=<span class="number">0</span>;</span><br><span class="line">RF2=<span class="number">1</span>;</span><br><span class="line">RB1=<span class="number">0</span>;</span><br><span class="line">RB2=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  RF1=<span class="number">0</span>;</span><br><span class="line">RF2=<span class="number">0</span>;</span><br><span class="line">RB1=<span class="number">0</span>;</span><br><span class="line">RB2=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">t = (t + <span class="number">1</span>) %<span class="number">50</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span><span class="comment">//跑直线</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">zkb1=<span class="number">7</span>;</span><br><span class="line">zkb2=<span class="number">7</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">right</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">zkb1=<span class="number">12</span>;</span><br><span class="line">zkb2=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">left</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">zkb1=<span class="number">0</span>;</span><br><span class="line">zkb2=<span class="number">12</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">stop</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">zkb1=<span class="number">0</span>;</span><br><span class="line">zkb2=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">delay</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> x,y;</span><br><span class="line">  <span class="keyword">for</span>(x=<span class="number">0</span>;x&lt;k;x++)</span><br><span class="line">  &#123;</span><br><span class="line">   <span class="keyword">for</span>(y=<span class="number">0</span>;y&lt;<span class="number">200</span>;y++);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">xunji</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> flag;</span><br><span class="line">    <span class="keyword">if</span>((XJ1==<span class="number">1</span>)&amp;&amp;(XJ2==<span class="number">0</span>))</span><br><span class="line">    &#123;</span><br><span class="line">   flag = <span class="number">0</span>;<span class="comment">//左边检测到黑线</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>((XJ1==<span class="number">0</span>)&amp;&amp;(XJ2==<span class="number">1</span>))</span><br><span class="line">    &#123;</span><br><span class="line">flag = <span class="number">1</span>;<span class="comment">//右边检测到黑线</span></span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>((XJ1==<span class="number">1</span>)&amp;&amp;(XJ2==<span class="number">1</span>))</span><br><span class="line">&#123;</span><br><span class="line">flag = <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"> flag = <span class="number">4</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>((BZ1==<span class="number">0</span>)||(BZ2==<span class="number">0</span>))</span><br><span class="line">&#123;</span><br><span class="line">flag = <span class="number">5</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">switch</span>(flag)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">0</span>:  right();delay(<span class="number">5</span>);stop();LED1=<span class="number">1</span>;LED2=<span class="number">0</span>;delay(<span class="number">5</span>);<span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>:  left();delay(<span class="number">5</span>);stop(); LED1=<span class="number">0</span>;LED2=<span class="number">1</span>;delay(<span class="number">5</span>);<span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">3</span>:  run();delay(<span class="number">1</span>);stop(); LED1=<span class="number">1</span>;LED2=<span class="number">1</span>; delay(<span class="number">1</span>);<span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">4</span>:  run();delay(<span class="number">1</span>);stop(); LED1=<span class="number">1</span>;LED2=<span class="number">1</span>; delay(<span class="number">1</span>);<span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">5</span>: stop();delay(<span class="number">5</span>);<span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">default</span>: run();delay(<span class="number">5</span>);stop(); LED1=<span class="number">1</span>;LED2=<span class="number">1</span>; delay(<span class="number">11</span>);<span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">PIT_Init();</span><br><span class="line">LED1=<span class="number">0</span>;</span><br><span class="line">LED2=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">xunji();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;参考代码&quot;&gt;&lt;a href=&quot;#参考代码&quot; class=&quot;headerlink&quot; title=&quot;参考代码&quot;&gt;&lt;/a&gt;参考代码&lt;/h1&gt;&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;s</summary>
      
    
    
    
    <category term="51单片机" scheme="https://ljweb.xyz/categories/51%E5%8D%95%E7%89%87%E6%9C%BA/"/>
    
    
    <category term="diy" scheme="https://ljweb.xyz/tags/diy/"/>
    
    <category term="51" scheme="https://ljweb.xyz/tags/51/"/>
    
  </entry>
  
  <entry>
    <title>11.9安科星轨</title>
    <link href="https://ljweb.xyz/2021/11/19/%E6%8B%8D%E8%BF%87%E7%9A%84%E4%B8%80%E4%BA%9B%E6%98%9F%E8%BD%A8/"/>
    <id>https://ljweb.xyz/2021/11/19/%E6%8B%8D%E8%BF%87%E7%9A%84%E4%B8%80%E4%BA%9B%E6%98%9F%E8%BD%A8/</id>
    <published>2021-11-19T14:58:26.000Z</published>
    <updated>2022-02-16T14:10:43.424Z</updated>
    
    <content type="html"><![CDATA[<hr><p>拍摄日期：2021年11月9日</p><p>设备：NIKON Z6</p><p>参数：15s f/5.6 24mm ISO1000</p><p><img src="/2021/11/19/%E6%8B%8D%E8%BF%87%E7%9A%84%E4%B8%80%E4%BA%9B%E6%98%9F%E8%BD%A8/AKXG11.9.jpg" alt="AKXG11.9"></p><hr>]]></content>
    
    
      
      
    <summary type="html">&lt;hr&gt;
&lt;p&gt;拍摄日期：2021年11月9日&lt;/p&gt;
&lt;p&gt;设备：NIKON Z6&lt;/p&gt;
&lt;p&gt;参数：15s f/5.6 24mm ISO1000&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/2021/11/19/%E6%8B%8D%E8%BF%87%E7%9A%84%E4%B8%8</summary>
      
    
    
    
    
    <category term="星轨" scheme="https://ljweb.xyz/tags/%E6%98%9F%E8%BD%A8/"/>
    
  </entry>
  
  <entry>
    <title>Hello World!</title>
    <link href="https://ljweb.xyz/2021/11/18/HELLO/"/>
    <id>https://ljweb.xyz/2021/11/18/HELLO/</id>
    <published>2021-11-18T19:17:15.000Z</published>
    <updated>2022-02-16T14:10:43.384Z</updated>
    
    <content type="html"><![CDATA[<h1 id="各种语言的Hello-World"><a href="#各种语言的Hello-World" class="headerlink" title="各种语言的Hello World"></a>各种语言的Hello World</h1><p>1.C语言</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mian</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Hello World!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2.python</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Hello World!&quot;</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;各种语言的Hello-World&quot;&gt;&lt;a href=&quot;#各种语言的Hello-World&quot; class=&quot;headerlink&quot; title=&quot;各种语言的Hello World&quot;&gt;&lt;/a&gt;各种语言的Hello World&lt;/h1&gt;&lt;p&gt;1.C语言&lt;/p&gt;
&lt;fig</summary>
      
    
    
    
    
  </entry>
  
</feed>
